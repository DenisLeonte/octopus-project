/*! permutive-javascript-sdk v9.11.6 (web) (built 2020-06-04 09:04:25 GMT+0000) */!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=26)}([function(t,e,n){"use strict";n.r(e),n.d(e,"URI",(function(){return o})),n.d(e,"none",(function(){return u})),n.d(e,"some",(function(){return a})),n.d(e,"isSome",(function(){return s})),n.d(e,"isNone",(function(){return c})),n.d(e,"fold",(function(){return f})),n.d(e,"fromNullable",(function(){return l})),n.d(e,"toNullable",(function(){return d})),n.d(e,"toUndefined",(function(){return p})),n.d(e,"getOrElse",(function(){return h})),n.d(e,"getOrElseW",(function(){return v})),n.d(e,"elem",(function(){return m})),n.d(e,"exists",(function(){return g})),n.d(e,"fromPredicate",(function(){return _})),n.d(e,"tryCatch",(function(){return y})),n.d(e,"getLeft",(function(){return b})),n.d(e,"getRight",(function(){return k})),n.d(e,"getRefinement",(function(){return w})),n.d(e,"mapNullable",(function(){return S})),n.d(e,"getShow",(function(){return E})),n.d(e,"getEq",(function(){return O})),n.d(e,"getOrd",(function(){return I})),n.d(e,"getApplySemigroup",(function(){return P})),n.d(e,"getApplyMonoid",(function(){return M})),n.d(e,"getFirstMonoid",(function(){return T})),n.d(e,"getLastMonoid",(function(){return x})),n.d(e,"getMonoid",(function(){return j})),n.d(e,"option",(function(){return A})),n.d(e,"alt",(function(){return N})),n.d(e,"ap",(function(){return D})),n.d(e,"apFirst",(function(){return L})),n.d(e,"apSecond",(function(){return W})),n.d(e,"chain",(function(){return z})),n.d(e,"chainFirst",(function(){return B})),n.d(e,"duplicate",(function(){return U})),n.d(e,"extend",(function(){return F})),n.d(e,"filter",(function(){return K})),n.d(e,"filterMap",(function(){return Q})),n.d(e,"flatten",(function(){return G})),n.d(e,"foldMap",(function(){return H})),n.d(e,"map",(function(){return J})),n.d(e,"partition",(function(){return V})),n.d(e,"partitionMap",(function(){return Y})),n.d(e,"reduce",(function(){return $})),n.d(e,"reduceRight",(function(){return X})),n.d(e,"compact",(function(){return Z})),n.d(e,"separate",(function(){return tt})),n.d(e,"fromEither",(function(){return et}));var r=n(2),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o="Option",u={_tag:"None"};function a(t){return{_tag:"Some",value:t}}function s(t){return"Some"===t._tag}function c(t){return"None"===t._tag}function f(t,e){return function(n){return c(n)?t():e(n.value)}}function l(t){return null==t?u:a(t)}function d(t){return c(t)?null:t.value}function p(t){return c(t)?void 0:t.value}function h(t){return function(e){return c(e)?t():e.value}}var v=h;function m(t){return function(e,n){return!c(n)&&t.equals(e,n.value)}}function g(t){return function(e){return!c(e)&&t(e.value)}}function _(t){return function(e){return t(e)?a(e):u}}function y(t){try{return a(t())}catch(t){return u}}function b(t){return"Right"===t._tag?u:a(t.left)}function k(t){return"Left"===t._tag?u:a(t.right)}function w(t){return function(e){return s(t(e))}}function S(t){return function(e){return c(e)?u:l(t(e.value))}}function E(t){return{show:function(e){return c(e)?"none":"some("+t.show(e.value)+")"}}}function O(t){return{equals:function(e,n){return e===n||(c(e)?c(n):!c(n)&&t.equals(e.value,n.value))}}}function I(t){return{equals:O(t).equals,compare:function(e,n){return e===n?0:s(e)?s(n)?t.compare(e.value,n.value):1:-1}}}function P(t){return{concat:function(e,n){return s(e)&&s(n)?a(t.concat(e.value,n.value)):u}}}function M(t){return i(i({},P(t)),{empty:a(t.empty)})}function T(){return{concat:function(t,e){return c(t)?e:t},empty:u}}function x(){return{concat:function(t,e){return c(e)?t:e},empty:u}}function j(t){return{concat:function(e,n){return c(e)?n:c(n)?e:a(t.concat(e.value,n.value))},empty:u}}var C={left:u,right:u},q=function(t){return t},A={URI:o,map:function(t,e){return c(t)?u:a(e(t.value))},of:a,ap:function(t,e){return c(t)||c(e)?u:a(t.value(e.value))},chain:function(t,e){return c(t)?u:e(t.value)},reduce:function(t,e,n){return c(t)?e:n(e,t.value)},foldMap:function(t){return function(e,n){return c(e)?t.empty:n(e.value)}},reduceRight:function(t,e,n){return c(t)?e:n(t.value,e)},traverse:function(t){return function(e,n){return c(e)?t.of(u):t.map(n(e.value),a)}},sequence:function(t){return function(e){return c(e)?t.of(u):t.map(e.value,a)}},zero:function(){return u},alt:function(t,e){return c(t)?e():t},extend:function(t,e){return c(t)?u:a(e(t))},compact:function(t){return A.chain(t,q)},separate:function(t){var e=A.map(t,(function(t){return{left:b(t),right:k(t)}}));return c(e)?C:e.value},filter:function(t,e){return c(t)?u:e(t.value)?t:u},filterMap:function(t,e){return c(t)?u:e(t.value)},partition:function(t,e){return{left:A.filter(t,(function(t){return!e(t)})),right:A.filter(t,e)}},partitionMap:function(t,e){return A.separate(A.map(t,e))},wither:function(t){return function(e,n){return c(e)?t.of(u):n(e.value)}},wilt:function(t){return function(e,n){var r=A.map(e,(function(e){return t.map(n(e),(function(t){return{left:b(t),right:k(t)}}))}));return c(r)?t.of({left:u,right:u}):r.value}},throwError:function(){return u}},R=Object(r.pipeable)(A),N=R.alt,D=R.ap,L=R.apFirst,W=R.apSecond,z=R.chain,B=R.chainFirst,U=R.duplicate,F=R.extend,K=R.filter,Q=R.filterMap,G=R.flatten,H=R.foldMap,J=R.map,V=R.partition,Y=R.partitionMap,$=R.reduce,X=R.reduceRight,Z=R.compact,tt=R.separate,et=R.fromEither},function(t,e,n){"use strict";n.r(e),n.d(e,"URI",(function(){return o})),n.d(e,"left",(function(){return u})),n.d(e,"right",(function(){return a})),n.d(e,"fromNullable",(function(){return s})),n.d(e,"toError",(function(){return c})),n.d(e,"tryCatch",(function(){return f})),n.d(e,"fold",(function(){return l})),n.d(e,"getShow",(function(){return d})),n.d(e,"getEq",(function(){return p})),n.d(e,"getSemigroup",(function(){return h})),n.d(e,"getApplySemigroup",(function(){return v})),n.d(e,"getApplyMonoid",(function(){return m})),n.d(e,"isLeft",(function(){return g})),n.d(e,"isRight",(function(){return _})),n.d(e,"swap",(function(){return y})),n.d(e,"orElse",(function(){return b})),n.d(e,"getOrElse",(function(){return k})),n.d(e,"getOrElseW",(function(){return w})),n.d(e,"elem",(function(){return S})),n.d(e,"exists",(function(){return E})),n.d(e,"parseJSON",(function(){return O})),n.d(e,"stringifyJSON",(function(){return I})),n.d(e,"getWitherable",(function(){return P})),n.d(e,"getValidation",(function(){return M})),n.d(e,"getValidationSemigroup",(function(){return T})),n.d(e,"getValidationMonoid",(function(){return x})),n.d(e,"either",(function(){return j})),n.d(e,"chainW",(function(){return $})),n.d(e,"alt",(function(){return q})),n.d(e,"ap",(function(){return A})),n.d(e,"apFirst",(function(){return R})),n.d(e,"apSecond",(function(){return N})),n.d(e,"bimap",(function(){return D})),n.d(e,"chain",(function(){return L})),n.d(e,"chainFirst",(function(){return W})),n.d(e,"duplicate",(function(){return z})),n.d(e,"extend",(function(){return B})),n.d(e,"flatten",(function(){return U})),n.d(e,"foldMap",(function(){return F})),n.d(e,"map",(function(){return K})),n.d(e,"mapLeft",(function(){return Q})),n.d(e,"reduce",(function(){return G})),n.d(e,"reduceRight",(function(){return H})),n.d(e,"fromOption",(function(){return J})),n.d(e,"fromPredicate",(function(){return V})),n.d(e,"filterOrElse",(function(){return Y}));var r=n(2),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o="Either";function u(t){return{_tag:"Left",left:t}}function a(t){return{_tag:"Right",right:t}}function s(t){return function(e){return null==e?u(t):a(e)}}function c(t){return t instanceof Error?t:new Error(String(t))}function f(t,e){try{return a(t())}catch(t){return u(e(t))}}function l(t,e){return function(n){return g(n)?t(n.left):e(n.right)}}function d(t,e){return{show:function(n){return g(n)?"left("+t.show(n.left)+")":"right("+e.show(n.right)+")"}}}function p(t,e){return{equals:function(n,r){return n===r||(g(n)?g(r)&&t.equals(n.left,r.left):_(r)&&e.equals(n.right,r.right))}}}function h(t){return{concat:function(e,n){return g(n)?e:g(e)?n:a(t.concat(e.right,n.right))}}}function v(t){return{concat:function(e,n){return g(e)?e:g(n)?n:a(t.concat(e.right,n.right))}}}function m(t){return i(i({},v(t)),{empty:a(t.empty)})}function g(t){switch(t._tag){case"Left":return!0;case"Right":return!1}}function _(t){return!g(t)}function y(t){return g(t)?a(t.left):u(t.right)}function b(t){return function(e){return g(e)?t(e.left):e}}function k(t){return function(e){return g(e)?t(e.left):e.right}}var w=k;function S(t){return function(e,n){return!g(n)&&t.equals(e,n.right)}}function E(t){return function(e){return!g(e)&&t(e.right)}}function O(t,e){return f((function(){return JSON.parse(t)}),e)}function I(t,e){return f((function(){return JSON.stringify(t)}),e)}function P(t){var e=u(t.empty),n=function(e){return g(e)?e:"None"===e.right._tag?u(t.empty):a(e.right.value)},r=function(t){return g(t)?{left:t,right:t}:g(t.right)?{left:a(t.right.left),right:e}:{left:e,right:a(t.right.right)}};return{URI:o,_E:void 0,map:j.map,compact:n,separate:r,filter:function(e,n){return g(e)||n(e.right)?e:u(t.empty)},filterMap:function(e,n){if(g(e))return e;var r=n(e.right);return"None"===r._tag?u(t.empty):a(r.value)},partition:function(t,n){return g(t)?{left:t,right:t}:n(t.right)?{left:e,right:a(t.right)}:{left:a(t.right),right:e}},partitionMap:function(t,n){if(g(t))return{left:t,right:t};var r=n(t.right);return g(r)?{left:a(r.left),right:e}:{left:e,right:a(r.right)}},traverse:j.traverse,sequence:j.sequence,reduce:j.reduce,foldMap:j.foldMap,reduceRight:j.reduceRight,wither:function(t){var e=j.traverse(t);return function(r,i){return t.map(e(r,i),n)}},wilt:function(t){var e=j.traverse(t);return function(n,i){return t.map(e(n,i),r)}}}}function M(t){return i(i({},j),{_E:void 0,ap:function(e,n){return g(e)?g(n)?u(t.concat(e.left,n.left)):e:g(n)?n:a(e.right(n.right))},alt:function(e,n){if(_(e))return e;var r=n();return g(r)?u(t.concat(e.left,r.left)):r}})}function T(t,e){return{concat:function(n,r){return g(n)?g(r)?u(t.concat(n.left,r.left)):n:g(r)?r:a(e.concat(n.right,r.right))}}}function x(t,e){return{concat:T(t,e).concat,empty:a(e.empty)}}var j={URI:o,map:function(t,e){return g(t)?t:a(e(t.right))},of:a,ap:function(t,e){return g(t)?t:g(e)?e:a(t.right(e.right))},chain:function(t,e){return g(t)?t:e(t.right)},reduce:function(t,e,n){return g(t)?e:n(e,t.right)},foldMap:function(t){return function(e,n){return g(e)?t.empty:n(e.right)}},reduceRight:function(t,e,n){return g(t)?e:n(t.right,e)},traverse:function(t){return function(e,n){return g(e)?t.of(u(e.left)):t.map(n(e.right),a)}},sequence:function(t){return function(e){return g(e)?t.of(u(e.left)):t.map(e.right,a)}},bimap:function(t,e,n){return g(t)?u(e(t.left)):a(n(t.right))},mapLeft:function(t,e){return g(t)?u(e(t.left)):t},alt:function(t,e){return g(t)?e():t},extend:function(t,e){return g(t)?t:a(e(t))},chainRec:function(t,e){return function(t,e){for(var n=e(t);"Left"===n._tag;)n=e(n.left);return n.right}(e(t),(function(t){return g(t)?a(u(t.left)):g(t.right)?u(e(t.right.left)):a(a(t.right.right))}))},throwError:u},C=Object(r.pipeable)(j),q=C.alt,A=C.ap,R=C.apFirst,N=C.apSecond,D=C.bimap,L=C.chain,W=C.chainFirst,z=C.duplicate,B=C.extend,U=C.flatten,F=C.foldMap,K=C.map,Q=C.mapLeft,G=C.reduce,H=C.reduceRight,J=C.fromOption,V=C.fromPredicate,Y=C.filterOrElse,$=L},function(t,e,n){"use strict";n.r(e),n.d(e,"pipe",(function(){return i})),n.d(e,"pipeable",(function(){return o}));var r=n(6);function i(t,e,n,r,i,o,u,a,s,c){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return i(r(n(e(t))));case 6:return o(i(r(n(e(t)))));case 7:return u(o(i(r(n(e(t))))));case 8:return a(u(o(i(r(n(e(t)))))));case 9:return s(a(u(o(i(r(n(e(t))))))));case 10:return c(s(a(u(o(i(r(n(e(t)))))))))}}function o(t){var e={};if(function(t){return"function"==typeof t.map}(t)){e.map=function(e){return function(n){return t.map(n,e)}}}if(function(t){return"function"==typeof t.contramap}(t)){e.contramap=function(e){return function(n){return t.contramap(n,e)}}}if(function(t){return"function"==typeof t.mapWithIndex}(t)){e.mapWithIndex=function(e){return function(n){return t.mapWithIndex(n,e)}}}if(function(t){return"function"==typeof t.ap}(t)){e.ap=function(e){return function(n){return t.ap(n,e)}},e.apFirst=function(e){return function(n){return t.ap(t.map(n,(function(t){return function(){return t}})),e)}},e.apSecond=function(e){return function(n){return t.ap(t.map(n,(function(){return function(t){return t}})),e)}}}if(function(t){return"function"==typeof t.chain}(t)){e.chain=function(e){return function(n){return t.chain(n,e)}},e.chainFirst=function(e){return function(n){return t.chain(n,(function(n){return t.map(e(n),(function(){return n}))}))}},e.flatten=function(e){return t.chain(e,r.identity)}}if(function(t){return"function"==typeof t.bimap}(t)){e.bimap=function(e,n){return function(r){return t.bimap(r,e,n)}},e.mapLeft=function(e){return function(n){return t.mapLeft(n,e)}}}if(function(t){return"function"==typeof t.extend}(t)){e.extend=function(e){return function(n){return t.extend(n,e)}},e.duplicate=function(e){return t.extend(e,r.identity)}}if(function(t){return"function"==typeof t.reduce}(t)){e.reduce=function(e,n){return function(r){return t.reduce(r,e,n)}},e.foldMap=function(e){var n=t.foldMap(e);return function(t){return function(e){return n(e,t)}}},e.reduceRight=function(e,n){return function(r){return t.reduceRight(r,e,n)}}}if(function(t){return"function"==typeof t.reduceWithIndex}(t)){e.reduceWithIndex=function(e,n){return function(r){return t.reduceWithIndex(r,e,n)}},e.foldMapWithIndex=function(e){var n=t.foldMapWithIndex(e);return function(t){return function(e){return n(e,t)}}},e.reduceRightWithIndex=function(e,n){return function(r){return t.reduceRightWithIndex(r,e,n)}}}if(function(t){return"function"==typeof t.alt}(t)){e.alt=function(e){return function(n){return t.alt(n,e)}}}if(function(t){return"function"==typeof t.compact}(t)&&(e.compact=t.compact,e.separate=t.separate),function(t){return"function"==typeof t.filter}(t)){e.filter=function(e){return function(n){return t.filter(n,e)}},e.filterMap=function(e){return function(n){return t.filterMap(n,e)}},e.partition=function(e){return function(n){return t.partition(n,e)}},e.partitionMap=function(e){return function(n){return t.partitionMap(n,e)}}}if(function(t){return"function"==typeof t.filterWithIndex}(t)){e.filterWithIndex=function(e){return function(n){return t.filterWithIndex(n,e)}},e.filterMapWithIndex=function(e){return function(n){return t.filterMapWithIndex(n,e)}},e.partitionWithIndex=function(e){return function(n){return t.partitionWithIndex(n,e)}},e.partitionMapWithIndex=function(e){return function(n){return t.partitionMapWithIndex(n,e)}}}if(function(t){return"function"==typeof t.promap}(t)){e.promap=function(e,n){return function(r){return t.promap(r,e,n)}}}if(function(t){return"function"==typeof t.compose}(t)){e.compose=function(e){return function(n){return t.compose(n,e)}}}if(function(t){return"function"==typeof t.throwError}(t)){e.fromOption=function(e){return function(n){return"None"===n._tag?t.throwError(e()):t.of(n.value)}},e.fromEither=function(e){return"Left"===e._tag?t.throwError(e.left):t.of(e.right)},e.fromPredicate=function(e,n){return function(r){return e(r)?t.of(r):t.throwError(n(r))}},e.filterOrElse=function(e,n){return function(r){return t.chain(r,(function(r){return e(r)?t.of(r):t.throwError(n(r))}))}}}return e}},function(t,e,n){"use strict";var r=n(14).Promise,i=n(34).polyfill;e.Promise=r,e.polyfill=i},function(t,e,n){"use strict";(function(t){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0}),e.objectEntries=e.uuidv4=e.onPageUnload=e.numericStringToNumber=e.nonPrimitiveEq=e.forP=e.findIndex=e.poller=e.deferredPromise=e.hash=e.lens=e.filterByKey=e.swap=e.mergeObjects=void 0,e.mergeObjects=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce((function(t,e){return n(n({},t),e)}),{})},e.swap=function(t){var e={};for(var n in t)e[t[n]]=n;return e},e.filterByKey=function(t,e){return Object.keys(t).filter(e).reduce((function(e,n){return e[n]=t[n],e}),{})},e.lens=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduce((function(t,e){return t?t[e]:void 0}),t)},e.hash=function(t){for(var e=0,n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e},e.deferredPromise=function(){var e,n;return{promise:new t((function(t,r){e=t,n=r})),reject:n,resolve:e}},e.poller=function(t,e,n){void 0===n&&(n=30);var r=0,i=!1;return function t(e,o,u){if(i||r>=n)return;var a=null;try{a=e()}catch(t){return}a?o():setTimeout((function(){r++,t(e,o,2*u)}),u)}(t,e,50),{cancel:function(){i=!0}}},e.findIndex=function(t,e){for(var n=-1,r=0;r<t.length;r++){var i=t[r];if(e(i)){n=t.indexOf(i);break}}return n},e.forP=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n){return e.reduce((function(e,n){return t.resolve(e).then(n)}),n)}},e.nonPrimitiveEq=function t(e,n){var r,i=function(t){return Object.keys(e).every(t)};switch(r=e,{}.toString.call(r).match(/\[object (\w+)\]/)[1]){case"Array":return e.length===n.length&&i((function(r){return t(e.sort()[r],n.sort()[r])}));case"Object":return Object.keys(e).length===Object.keys(n).length&&i((function(r){return t(e[r],n[r])}));default:return e===n}},e.numericStringToNumber=function(t){if("string"==typeof t){var e=+t;if(!isNaN(e))return e}return t},e.onPageUnload=function(t){var e=function(e){if(!n&&e)return n=!0,t()},n=!1;["blur","visibilitychange"].forEach((function(t){window.addEventListener(t,(function(){return e(document.hidden&&/Mobi|Android/i.test(navigator.userAgent))}))})),["beforeunload","pagehide"].forEach((function(t){window.addEventListener(t,(function(){return e(!0)}))}))},e.uuidv4=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^(window.crypto||window.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))},e.objectEntries=function(t){return Object.keys(t).reduce((function(e,n){return i(e,[[n,t[n]]])}),[])}}).call(this,n(3).Promise)},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"URI",(function(){return o})),n.d(e,"never",(function(){return u})),n.d(e,"getSemigroup",(function(){return a})),n.d(e,"getMonoid",(function(){return s})),n.d(e,"getRaceMonoid",(function(){return c})),n.d(e,"delay",(function(){return f})),n.d(e,"fromIO",(function(){return l})),n.d(e,"of",(function(){return d})),n.d(e,"fromIOK",(function(){return p})),n.d(e,"chainIOK",(function(){return h})),n.d(e,"task",(function(){return v})),n.d(e,"taskSeq",(function(){return m})),n.d(e,"ap",(function(){return _})),n.d(e,"apFirst",(function(){return y})),n.d(e,"apSecond",(function(){return b})),n.d(e,"chain",(function(){return k})),n.d(e,"chainFirst",(function(){return w})),n.d(e,"flatten",(function(){return S})),n.d(e,"map",(function(){return E}));var r=n(2),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o="Task",u=function(){return new t((function(t){}))};function a(t){return{concat:function(e,n){return function(){return e().then((function(e){return n().then((function(n){return t.concat(e,n)}))}))}}}}function s(t){return{concat:a(t).concat,empty:v.of(t.empty)}}function c(){return{concat:function(e,n){return function(){return t.race([e(),n()])}},empty:u}}function f(e){return function(n){return function(){return new t((function(t){setTimeout((function(){n().then(t)}),e)}))}}}function l(e){return function(){return t.resolve(e())}}function d(e){return function(){return t.resolve(e)}}function p(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return l(t.apply(void 0,e))}}function h(t){return k(p(t))}var v={URI:o,map:function(t,e){return function(){return t().then(e)}},of:d,ap:function(e,n){return function(){return t.all([e(),n()]).then((function(t){return(0,t[0])(t[1])}))}},chain:function(t,e){return function(){return t().then((function(t){return e(t)()}))}},fromIO:l,fromTask:function(t){return t}},m=i(i({},v),{ap:function(t,e){return function(){return t().then((function(t){return e().then((function(e){return t(e)}))}))}}}),g=Object(r.pipeable)(v),_=g.ap,y=g.apFirst,b=g.apSecond,k=g.chain,w=g.chainFirst,S=g.flatten,E=g.map}.call(this,n(3).Promise)},function(t,e,n){"use strict";function r(t){return t}n.r(e),n.d(e,"identity",(function(){return r})),n.d(e,"unsafeCoerce",(function(){return i})),n.d(e,"not",(function(){return o})),n.d(e,"constant",(function(){return u})),n.d(e,"constTrue",(function(){return a})),n.d(e,"constFalse",(function(){return s})),n.d(e,"constNull",(function(){return c})),n.d(e,"constUndefined",(function(){return f})),n.d(e,"constVoid",(function(){return l})),n.d(e,"flip",(function(){return d})),n.d(e,"flow",(function(){return p})),n.d(e,"tuple",(function(){return h})),n.d(e,"increment",(function(){return v})),n.d(e,"decrement",(function(){return m})),n.d(e,"absurd",(function(){return g})),n.d(e,"tupled",(function(){return _})),n.d(e,"untupled",(function(){return y}));var i=r;function o(t){return function(e){return!t(e)}}function u(t){return function(){return t}}var a=function(){return!0},s=function(){return!1},c=function(){return null},f=function(){},l=function(){};function d(t){return function(e,n){return t(n,e)}}function p(t,e,n,r,i,o,u,a,s){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return i(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return o(i(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return u(o(i(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return a(u(o(i(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return s(a(u(o(i(r(n(e(t.apply(this,arguments)))))))))}}}function h(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t}function v(t){return t+1}function m(t){return t-1}function g(t){throw new Error("Called `absurd` function which should be uncallable")}function _(t){return function(e){return t.apply(void 0,e)}}function y(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t(e)}}},function(t,e,n){"use strict";function r(t){return"function"==typeof t}var i=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=function(t){return r(t)||"object"==typeof t&&null!==t},e.isFunction=r,e.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.now=i},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.isFullPermutiveEventJson=e.isEventTrackError=e.deserializeMinimalEvent=e.serializeEvent=e.deserializeEvent=void 0,e.deserializeEvent=function(t){return r({id:t.id,name:t.name,time:new Date(t.time),properties:t.properties||{}},i(t))},e.serializeEvent=function(t){return r({id:t.id||null,name:t.name,time:(o(t.time)?t.time:new Date).toISOString(),properties:t.properties||{}},i(t))},e.deserializeMinimalEvent=function(t,e){return r({id:t.id,time:new Date(t.time),name:e.name,properties:e.properties},i(e))},e.isEventTrackError=function(t){return void 0!==t.request_id},e.isFullPermutiveEventJson=function(t){return void 0!==t.properties};var i=function(t){return r(r({},t.session_id?{session_id:t.session_id}:{}),t.view_id?{view_id:t.view_id}:{})},o=function(t){return isFinite(t)&&t instanceof Date}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(10),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(t,e){return i(i({},Object(r.a)(t,e)),{of:function(n){return t.of(e.of(n))},ap:function(n,r){return t.ap(t.map(n,(function(t){return function(n){return e.ap(t,n)}})),r)}})}},function(t,e,n){"use strict";function r(t,e){return{map:function(n,r){return t.map(n,(function(t){return e.map(t,r)}))}}}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"URI",(function(){return l})),n.d(e,"left",(function(){return d})),n.d(e,"right",(function(){return p})),n.d(e,"rightIO",(function(){return h})),n.d(e,"leftIO",(function(){return v})),n.d(e,"rightTask",(function(){return m})),n.d(e,"leftTask",(function(){return g})),n.d(e,"fromIOEither",(function(){return _})),n.d(e,"fold",(function(){return y})),n.d(e,"getOrElse",(function(){return b})),n.d(e,"getOrElseW",(function(){return k})),n.d(e,"orElse",(function(){return w})),n.d(e,"swap",(function(){return S})),n.d(e,"getSemigroup",(function(){return E})),n.d(e,"getApplySemigroup",(function(){return O})),n.d(e,"getApplyMonoid",(function(){return I})),n.d(e,"tryCatch",(function(){return P})),n.d(e,"bracket",(function(){return M})),n.d(e,"taskify",(function(){return T})),n.d(e,"getTaskValidation",(function(){return x})),n.d(e,"getFilterable",(function(){return j})),n.d(e,"fromEitherK",(function(){return C})),n.d(e,"chainEitherK",(function(){return q})),n.d(e,"fromIOEitherK",(function(){return A})),n.d(e,"chainIOEitherK",(function(){return R})),n.d(e,"tryCatchK",(function(){return N})),n.d(e,"taskEither",(function(){return D})),n.d(e,"taskEitherSeq",(function(){return L})),n.d(e,"chainW",(function(){return tt})),n.d(e,"alt",(function(){return z})),n.d(e,"ap",(function(){return B})),n.d(e,"apFirst",(function(){return U})),n.d(e,"apSecond",(function(){return F})),n.d(e,"bimap",(function(){return K})),n.d(e,"chain",(function(){return Q})),n.d(e,"chainFirst",(function(){return G})),n.d(e,"flatten",(function(){return H})),n.d(e,"map",(function(){return J})),n.d(e,"mapLeft",(function(){return V})),n.d(e,"fromEither",(function(){return Y})),n.d(e,"fromOption",(function(){return $})),n.d(e,"fromPredicate",(function(){return X})),n.d(e,"filterOrElse",(function(){return Z}));var r=n(1),i=n(23),o=n(25),u=n(2),a=n(5),s=n(24),c=function(){return(c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},f=Object(i.a)(a.task),l="TaskEither",d=f.left,p=f.of;function h(t){return m(a.task.fromIO(t))}function v(t){return g(a.task.fromIO(t))}var m=f.rightM,g=f.leftM,_=a.task.fromIO;function y(t,e){return function(n){return f.fold(n,t,e)}}function b(t){return function(e){return f.getOrElse(e,t)}}var k=b;function w(t){return function(e){return f.orElse(e,t)}}var S=f.swap;function E(t){return Object(a.getSemigroup)(r.getSemigroup(t))}function O(t){return Object(a.getSemigroup)(r.getApplySemigroup(t))}function I(t){return{concat:O(t).concat,empty:p(t.empty)}}function P(t,e){return function(){return t().then(r.right,(function(t){return r.left(e(t))}))}}function M(t,e,n){return f.chain(t,(function(t){return f.chain(a.task.map(e(t),r.right),(function(e){return f.chain(n(t,e),(function(){return r.isLeft(e)?f.left(e.left):f.of(e.right)}))}))}))}function T(e){return function(){var n=Array.prototype.slice.call(arguments);return function(){return new t((function(t){e.apply(null,n.concat((function(e,n){return t(null!=e?r.left(e):r.right(n))})))}))}}}function x(t){var e=Object(s.a)(t,a.task);return c(c({_E:void 0},D),e)}function j(t){var e=r.getWitherable(t);return c({URI:l,_E:void 0},Object(o.a)(a.task,e))}function C(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Y(t.apply(void 0,e))}}function q(t){return Q(C(t))}function A(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return _(t.apply(void 0,e))}}function R(t){return Q(A(t))}function N(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return P((function(){return t.apply(void 0,n)}),e)}}var D={URI:l,bimap:f.bimap,mapLeft:f.mapLeft,map:f.map,of:f.of,ap:f.ap,chain:f.chain,alt:f.alt,fromIO:h,fromTask:m,throwError:d},L=c(c({},D),{ap:function(t,e){return f.chain(t,(function(t){return f.map(e,t)}))}}),W=Object(u.pipeable)(D),z=W.alt,B=W.ap,U=W.apFirst,F=W.apSecond,K=W.bimap,Q=W.chain,G=W.chainFirst,H=W.flatten,J=W.map,V=W.mapLeft,Y=W.fromEither,$=W.fromOption,X=W.fromPredicate,Z=W.filterOrElse,tt=Q}.call(this,n(3).Promise)},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hasBrokenIdentity=e.PermutiveIdentities=void 0;var r=n(13),i=n(18),o=function(){function e(t,e){this._internals=t,this.network=e,this.identities=this._internals.state.getPermutiveData("identities")||{},this.currentAliases=this._internals.state.getPermutiveData("aliases")||{},this.providers={}}return e.getAliasesFromIdentifyArg=function(t){if("string"!=typeof t&&"object"!=typeof t||null===t||""===t)throw new Error("Identify must be passed a non-empty string or list of aliases, value passed was '"+t+"'");return"string"==typeof t?[{id:t,tag:"default"}]:t},e.prototype.setIdentity=function(t,e,n){void 0===n&&(n=86400),this.identities[t]={value:e,expiry:Date.now()+Math.floor(1e3*n)},this._internals.state.setPermutiveData("identities",this.identities)},e.prototype.getIdentity=function(t){return{defined:t in this.identities,value:t in this.identities?this.identities[t].value:void 0}},e.prototype.getIdentities=function(t){var e=this;return void 0===t&&(t=!1),Object.keys(this.identities).reduce((function(n,r){var i=e.getIdentity(r).value;return void 0!==i&&(t&&!e.getProvider(r).usedForThirdPartyData()||(n[r]=i)),n}),{})},e.prototype.hasExpired=function(t){return!(t in this.identities)||Date.now()>=this.identities[t].expiry},e.prototype.registerProvider=function(t){this.providers[t.getTag()]=t},e.prototype.getProvider=function(t){return t in this.providers?this.providers[t]:(this.network.error("Identity provider "+t+" is not registered.",this._internals.state.userId),null)},e.prototype.retrieveIdentity=function(e){var n=this,r=this.getProvider(e);return null===r?t.resolve(void 0):r.getId().then((function(t){var e=void 0===t?"sdk_third_party_identity_missing_count":"sdk_third_party_identity_present_count";return n._internals.metrics.track({name:e,value:1,labels:{identity_tag:r.getTag()}}),n.setIdentity(r.getTag(),t,r.getTtlInSeconds()),t}))},e.prototype.retrieveAllIdentities=function(){var e=this,n=this._internals.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),r=[],i=function(n){if(!o.providers.hasOwnProperty(n))return"continue";var i=o.getIdentity(n),u=!i.defined||o.hasExpired(n)?o.retrieveIdentity(n):t.resolve(i.value);u.then((function(t){return void 0!==t?e._internals.api.identify([{id:t,tag:n}]):null})),r.push(u)},o=this;for(var u in this.providers)i(u);return t.all(r).then((function(t){return e._internals.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",n),t}))},e.prototype.addAlias=function(t,e){this.currentAliases[e]=t},e.prototype.removeAliasByTag=function(t){delete this.currentAliases[t]},e.prototype.storeAliases=function(t){this._internals.state.setPermutiveData("aliases",t)},e.prototype.convertAliases=function(t){var e=this,n={default:0},r=function(t){return e._internals.identities.getIdentity(t).defined?t in n?n[t]+1:1:0};return Object.keys(t).map((function(e){return{id:t[e],tag:e,priority:r(e)}}))},e}();e.PermutiveIdentities=o,e.hasBrokenIdentity=function(t,e,n,o){var a={"e43c8a90-d17b-4790-bfda-81b069b3b8c2":function(t,e,n){return["thestudentroom.co.uk"].some((function(t){return n.indexOf(t)>-1}))&&r.intersection(i.eqString)(e,["tsr-"]).length>0},"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":function(t,e){return!!u[t]||r.intersection(i.eqString)(e,["(null)"]).length>0}}[t];return!!a&&a(o,e,n)};var u={}}).call(this,n(3).Promise)},function(t,e,n){"use strict";n.r(e),n.d(e,"URI",(function(){return R})),n.d(e,"getShow",(function(){return N})),n.d(e,"getMonoid",(function(){return D})),n.d(e,"getEq",(function(){return L})),n.d(e,"getOrd",(function(){return W})),n.d(e,"empty",(function(){return z})),n.d(e,"makeBy",(function(){return B})),n.d(e,"range",(function(){return U})),n.d(e,"replicate",(function(){return F})),n.d(e,"flatten",(function(){return K})),n.d(e,"foldLeft",(function(){return Q})),n.d(e,"foldRight",(function(){return G})),n.d(e,"scanLeft",(function(){return H})),n.d(e,"scanRight",(function(){return J})),n.d(e,"isEmpty",(function(){return V})),n.d(e,"isNonEmpty",(function(){return Y})),n.d(e,"isOutOfBound",(function(){return $})),n.d(e,"lookup",(function(){return X})),n.d(e,"cons",(function(){return Z})),n.d(e,"snoc",(function(){return tt})),n.d(e,"head",(function(){return et})),n.d(e,"last",(function(){return nt})),n.d(e,"tail",(function(){return rt})),n.d(e,"init",(function(){return it})),n.d(e,"takeLeft",(function(){return ot})),n.d(e,"takeRight",(function(){return ut})),n.d(e,"takeLeftWhile",(function(){return at})),n.d(e,"spanLeft",(function(){return st})),n.d(e,"dropLeft",(function(){return ct})),n.d(e,"dropRight",(function(){return ft})),n.d(e,"dropLeftWhile",(function(){return lt})),n.d(e,"findIndex",(function(){return dt})),n.d(e,"findFirst",(function(){return pt})),n.d(e,"findFirstMap",(function(){return ht})),n.d(e,"findLast",(function(){return vt})),n.d(e,"findLastMap",(function(){return mt})),n.d(e,"findLastIndex",(function(){return gt})),n.d(e,"copy",(function(){return _t})),n.d(e,"unsafeInsertAt",(function(){return yt})),n.d(e,"insertAt",(function(){return bt})),n.d(e,"unsafeUpdateAt",(function(){return kt})),n.d(e,"updateAt",(function(){return wt})),n.d(e,"unsafeDeleteAt",(function(){return St})),n.d(e,"deleteAt",(function(){return Et})),n.d(e,"modifyAt",(function(){return Ot})),n.d(e,"reverse",(function(){return It})),n.d(e,"rights",(function(){return Pt})),n.d(e,"lefts",(function(){return Mt})),n.d(e,"sort",(function(){return Tt})),n.d(e,"zipWith",(function(){return xt})),n.d(e,"zip",(function(){return jt})),n.d(e,"unzip",(function(){return Ct})),n.d(e,"rotate",(function(){return qt})),n.d(e,"elem",(function(){return At})),n.d(e,"uniq",(function(){return Rt})),n.d(e,"sortBy",(function(){return Nt})),n.d(e,"chop",(function(){return Dt})),n.d(e,"splitAt",(function(){return Lt})),n.d(e,"chunksOf",(function(){return Wt})),n.d(e,"comprehension",(function(){return zt})),n.d(e,"union",(function(){return Bt})),n.d(e,"intersection",(function(){return Ut})),n.d(e,"difference",(function(){return Ft})),n.d(e,"of",(function(){return Kt})),n.d(e,"array",(function(){return Qt})),n.d(e,"alt",(function(){return Ht})),n.d(e,"ap",(function(){return Jt})),n.d(e,"apFirst",(function(){return Vt})),n.d(e,"apSecond",(function(){return Yt})),n.d(e,"chain",(function(){return $t})),n.d(e,"chainFirst",(function(){return Xt})),n.d(e,"duplicate",(function(){return Zt})),n.d(e,"extend",(function(){return te})),n.d(e,"filter",(function(){return ee})),n.d(e,"filterMap",(function(){return ne})),n.d(e,"filterMapWithIndex",(function(){return re})),n.d(e,"filterWithIndex",(function(){return ie})),n.d(e,"foldMap",(function(){return oe})),n.d(e,"foldMapWithIndex",(function(){return ue})),n.d(e,"map",(function(){return ae})),n.d(e,"mapWithIndex",(function(){return se})),n.d(e,"partition",(function(){return ce})),n.d(e,"partitionMap",(function(){return fe})),n.d(e,"partitionMapWithIndex",(function(){return le})),n.d(e,"partitionWithIndex",(function(){return de})),n.d(e,"reduce",(function(){return pe})),n.d(e,"reduceRight",(function(){return he})),n.d(e,"reduceRightWithIndex",(function(){return ve})),n.d(e,"reduceWithIndex",(function(){return me})),n.d(e,"compact",(function(){return ge})),n.d(e,"separate",(function(){return _e}));var r=n(2),i=n(6),o=n(0);var u={concat:function(t,e){return 0!==t?t:e},empty:0};var a=function(t,e){return t<e?-1:t>e?1:0};function s(t,e){return t===e}var c={equals:s,compare:a};function f(t){var e=function(e,n){return e===n?0:t(e,n)};return{equals:function(t,n){return 0===e(t,n)},compare:e}}var l={concat:{concat:function(t,e){return f((function(n,r){return u.concat(t.compare(n,r),e.compare(n,r))}))}}.concat,empty:f((function(){return 0}))};var d={URI:"Ord",contramap:function(t,e){return f((function(n,r){return t.compare(e(n),e(r))}))}},p=(Object(r.pipeable)(d).contramap,d.contramap(c,(function(t){return t.valueOf()})),function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],u=0,a=o.length;u<a;u++,i++)r[i]=o[u];return r});var h=function(t,e){var n=t.length;if(0===n)return e;var r=e.length;if(0===r)return t;for(var i=Array(n+r),o=0;o<n;o++)i[o]=t[o];for(o=0;o<r;o++)i[o+n]=e[o];return i};var v=[];function m(t,e){for(var n=[],r=0;r<t;r++)n.push(e(r));return n}function g(t){for(var e=0,n=t.length,r=0;r<n;r++)e+=t[r].length;var i=Array(e),o=0;for(r=0;r<n;r++){for(var u=t[r],a=u.length,s=0;s<a;s++)i[s+o]=u[s];o+=a}return i}function _(t){return 0===t.length}function y(t){return t.length>0}function b(t,e){return t<0||t>=e.length}function k(t,e){return b(t,e)?o.none:Object(o.some)(e[t])}function w(t,e){for(var n=t.length,r=Array(n+1),i=0;i<n;i++)r[i]=t[i];return r[n]=e,r}var S=function(t,e){for(var n=t.length,r=0;r<n&&e(t[r]);r++);return r};function E(t,e,n){var r=p(n);return r.splice(t,0,e),r}function O(t,e,n){if(n[t]===e)return n;var r=p(n);return r[t]=e,r}function I(t,e){var n=p(e);return n.splice(t,1),n}function P(t){return function(e){return p(e).sort(t.compare)}}function M(t,e,n){for(var r=[],i=Math.min(t.length,e.length),o=0;o<i;o++)r[o]=n(t[o],e[o]);return r}function T(t){return function(e,n){for(var r,i=0,o=n.length;i<o;i++)if(r=n[i],t.equals(r,e))return!0;return!1}}function x(t){return function(e){for(var n=[],r=e;y(r);){var i=t(r),o=i[0],u=i[1];n.push(o),r=u}return n}}function j(t){return function(e){return[e.slice(0,t),e.slice(t)]}}var C=function(t){return[t]},q={URI:"ReadonlyArray",map:function(t,e){return t.map((function(t){return e(t)}))},mapWithIndex:function(t,e){return t.map((function(t,n){return e(n,t)}))},compact:function(t){return q.filterMap(t,i.identity)},separate:function(t){for(var e=[],n=[],r=0,i=t;r<i.length;r++){var o=i[r];"Left"===o._tag?e.push(o.left):n.push(o.right)}return{left:e,right:n}},filter:function(t,e){return t.filter(e)},filterMap:function(t,e){return q.filterMapWithIndex(t,(function(t,n){return e(n)}))},partition:function(t,e){return q.partitionWithIndex(t,(function(t,n){return e(n)}))},partitionMap:function(t,e){return q.partitionMapWithIndex(t,(function(t,n){return e(n)}))},of:C,ap:function(t,e){return g(q.map(t,(function(t){return q.map(e,t)})))},chain:function(t,e){for(var n=0,r=t.length,i=new Array(r),o=0;o<r;o++){n+=(s=e(t[o])).length,i[o]=s}var u=Array(n),a=0;for(o=0;o<r;o++){for(var s,c=(s=i[o]).length,f=0;f<c;f++)u[f+a]=s[f];a+=c}return u},reduce:function(t,e,n){return q.reduceWithIndex(t,e,(function(t,e,r){return n(e,r)}))},foldMap:function(t){var e=q.foldMapWithIndex(t);return function(t,n){return e(t,(function(t,e){return n(e)}))}},reduceRight:function(t,e,n){return q.reduceRightWithIndex(t,e,(function(t,e,r){return n(e,r)}))},unfold:function(t,e){for(var n=[],r=t;;){var i=e(r);if(!Object(o.isSome)(i))break;var u=i.value,a=u[0],s=u[1];n.push(a),r=s}return n},traverse:function(t){var e=q.traverseWithIndex(t);return function(t,n){return e(t,(function(t,e){return n(e)}))}},sequence:function(t){return function(e){return q.reduce(e,t.of(q.zero()),(function(e,n){return t.ap(t.map(e,(function(t){return function(e){return w(t,e)}})),n)}))}},zero:function(){return v},alt:function(t,e){return h(t,e())},extend:function(t,e){return t.map((function(t,n,r){return e(r.slice(n))}))},wither:function(t){var e=q.traverse(t);return function(n,r){return t.map(e(n,r),q.compact)}},wilt:function(t){var e=q.traverse(t);return function(n,r){return t.map(e(n,r),q.separate)}},reduceWithIndex:function(t,e,n){for(var r=t.length,i=e,o=0;o<r;o++)i=n(o,i,t[o]);return i},foldMapWithIndex:function(t){return function(e,n){return e.reduce((function(e,r,i){return t.concat(e,n(i,r))}),t.empty)}},reduceRightWithIndex:function(t,e,n){return t.reduceRight((function(t,e,r){return n(r,e,t)}),e)},traverseWithIndex:function(t){return function(e,n){return q.reduceWithIndex(e,t.of(q.zero()),(function(e,r,i){return t.ap(t.map(r,(function(t){return function(e){return w(t,e)}})),n(e,i))}))}},partitionMapWithIndex:function(t,e){for(var n=[],r=[],i=0;i<t.length;i++){var o=e(i,t[i]);"Left"===o._tag?n.push(o.left):r.push(o.right)}return{left:n,right:r}},partitionWithIndex:function(t,e){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return{left:n,right:r}},filterMapWithIndex:function(t,e){for(var n=[],r=0;r<t.length;r++){var i=e(r,t[r]);Object(o.isSome)(i)&&n.push(i.value)}return n},filterWithIndex:function(t,e){return t.filter((function(t,n){return e(n,t)}))}},A=Object(r.pipeable)(q),R=(A.alt,A.ap,A.apFirst,A.apSecond,A.chain,A.chainFirst,A.duplicate,A.extend,A.filter,A.filterMap,A.filterMapWithIndex,A.filterWithIndex,A.foldMap,A.foldMapWithIndex,A.map,A.mapWithIndex,A.partition,A.partitionMap,A.partitionMapWithIndex,A.partitionWithIndex,A.reduce,A.reduceRight,A.reduceRightWithIndex,A.reduceWithIndex,A.compact,A.separate,"Array"),N=function(t){return{show:function(e){return"["+e.map(t.show).join(", ")+"]"}}},D=function(){return{concat:h,empty:v}},L=function(t){return{equals:function(e,n){return e===n||e.length===n.length&&e.every((function(e,r){return t.equals(e,n[r])}))}}},W=function(t){return f((function(e,n){for(var r=e.length,i=n.length,o=Math.min(r,i),u=0;u<o;u++){var a=t.compare(e[u],n[u]);if(0!==a)return a}return c.compare(r,i)}))},z=[],B=m,U=function(t,e){return m(e-t+1,(function(e){return t+e}))},F=function(t,e){return m(t,(function(){return e}))},K=g,Q=function(t,e){return function(n){return _(n)?t():e(n[0],n.slice(1))}},G=function(t,e){return function(n){return _(n)?t():e(n.slice(0,n.length-1),n[n.length-1])}},H=function(t,e){return function(n){var r=n.length,i=new Array(r+1);i[0]=t;for(var o=0;o<r;o++)i[o+1]=e(i[o],n[o]);return i}},J=function(t,e){return function(n){var r=n.length,i=new Array(r+1);i[r]=t;for(var o=r-1;o>=0;o--)i[o]=e(n[o],i[o+1]);return i}},V=_,Y=y,$=b,X=k,Z=function(t,e){for(var n=e.length,r=Array(n+1),i=0;i<n;i++)r[i+1]=e[i];return r[0]=t,r},tt=w,et=function(t){return _(t)?o.none:Object(o.some)(t[0])},nt=function(t){return k(t.length-1,t)},rt=function(t){return _(t)?o.none:Object(o.some)(t.slice(1))},it=function(t){var e=t.length;return 0===e?o.none:Object(o.some)(t.slice(0,e-1))},ot=function(t){return function(e){return e.slice(0,t)}},ut=function(t){return function(e){return 0===t?v:e.slice(-t)}};function at(t){return function(t){return function(e){for(var n=S(e,t),r=Array(n),i=0;i<n;i++)r[i]=e[i];return r}}(t)}function st(t){return function(t){return function(e){for(var n=S(e,t),r=Array(n),i=0;i<n;i++)r[i]=e[i];var o=e.length,u=Array(o-n);for(i=n;i<o;i++)u[i-n]=e[i];return{init:r,rest:u}}}(t)}var ct=function(t){return function(e){return e.slice(t,e.length)}},ft=function(t){return function(e){return e.slice(0,e.length-t)}},lt=function(t){return function(e){for(var n=S(e,t),r=e.length,i=Array(r-n),o=n;o<r;o++)i[o-n]=e[o];return i}},dt=function(t){return function(e){for(var n=e.length,r=0;r<n;r++)if(t(e[r]))return Object(o.some)(r);return o.none}};function pt(t){return function(t){return function(e){for(var n=e.length,r=0;r<n;r++)if(t(e[r]))return Object(o.some)(e[r]);return o.none}}(t)}var ht=function(t){return function(e){for(var n=e.length,r=0;r<n;r++){var i=t(e[r]);if(Object(o.isSome)(i))return i}return o.none}};function vt(t){return function(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return Object(o.some)(e[n]);return o.none}}(t)}var mt=function(t){return function(e){for(var n=e.length-1;n>=0;n--){var r=t(e[n]);if(Object(o.isSome)(r))return r}return o.none}},gt=function(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return Object(o.some)(n);return o.none}},_t=function(t){for(var e=t.length,n=Array(e),r=0;r<e;r++)n[r]=t[r];return n},yt=E,bt=function(t,e){return function(n){return t<0||t>n.length?o.none:Object(o.some)(E(t,e,n))}},kt=O,wt=function(t,e){return function(n){return b(t,n)?o.none:Object(o.some)(O(t,e,n))}},St=I,Et=function(t){return function(e){return b(t,e)?o.none:Object(o.some)(I(t,e))}},Ot=function(t,e){return function(n){return b(t,n)?o.none:Object(o.some)(O(t,e(n[t]),n))}},It=function(t){return p(t).reverse()},Pt=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];"Right"===i._tag&&e.push(i.right)}return e},Mt=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];"Left"===i._tag&&e.push(i.left)}return e},Tt=P,xt=M,jt=function(t,e){return M(t,e,(function(t,e){return[t,e]}))},Ct=function(t){for(var e=[],n=[],r=0;r<t.length;r++)e[r]=t[r][0],n[r]=t[r][1];return[e,n]},qt=function t(e){return function(n){var r=n.length;return 0===e||r<=1||r===Math.abs(e)?n:e<0?t(r+e)(n):n.slice(-e).concat(n.slice(0,r-e))}},At=T,Rt=function(t){var e=T(t);return function(t){for(var n=[],r=t.length,i=0;i<r;i++){var o=t[i];e(o,n)||n.push(o)}return r===n.length?t:n}},Nt=function(t){var e=l;return P(t.reduce(e.concat,e.empty))},Dt=x,Lt=j,Wt=function(t){var e=x(j(t));return function(n){return 0===n.length?v:b(t-1,n)?[n]:e(n)}};function zt(t,e,n){return void 0===n&&(n=function(){return!0}),function(t,e,n){void 0===n&&(n=function(){return!0});var r=function(t,i){return 0===i.length?n.apply(void 0,t)?[e.apply(void 0,t)]:v:q.chain(i[0],(function(e){return r(w(t,e),i.slice(1))}))};return r(v,t)}(t,e,n)}var Bt=function(t){var e=T(t);return function(t,n){return h(t,n.filter((function(n){return!e(n,t)})))}},Ut=function(t){var e=T(t);return function(t,n){return t.filter((function(t){return e(t,n)}))}},Ft=function(t){var e=T(t);return function(t,n){return t.filter((function(t){return!e(t,n)}))}},Kt=C,Qt={URI:R,map:q.map,mapWithIndex:q.mapWithIndex,compact:q.compact,separate:q.separate,filter:q.filter,filterMap:q.filterMap,partition:q.partition,partitionMap:q.partitionMap,of:Kt,ap:q.ap,chain:q.chain,reduce:q.reduce,foldMap:q.foldMap,reduceRight:q.reduceRight,unfold:q.unfold,traverse:q.traverse,sequence:q.sequence,zero:q.zero,alt:q.alt,extend:q.extend,wither:q.wither,wilt:q.wilt,reduceWithIndex:q.reduceWithIndex,foldMapWithIndex:q.foldMapWithIndex,reduceRightWithIndex:q.reduceRightWithIndex,traverseWithIndex:q.traverseWithIndex,partitionMapWithIndex:q.partitionMapWithIndex,partitionWithIndex:q.partitionWithIndex,filterMapWithIndex:q.filterMapWithIndex,filterWithIndex:q.filterWithIndex},Gt=Object(r.pipeable)(Qt),Ht=Gt.alt,Jt=Gt.ap,Vt=Gt.apFirst,Yt=Gt.apSecond,$t=Gt.chain,Xt=Gt.chainFirst,Zt=Gt.duplicate,te=Gt.extend,ee=Gt.filter,ne=Gt.filterMap,re=Gt.filterMapWithIndex,ie=Gt.filterWithIndex,oe=Gt.foldMap,ue=Gt.foldMapWithIndex,ae=Gt.map,se=Gt.mapWithIndex,ce=Gt.partition,fe=Gt.partitionMap,le=Gt.partitionMapWithIndex,de=Gt.partitionWithIndex,pe=Gt.reduce,he=Gt.reduceRight,ve=Gt.reduceRightWithIndex,me=Gt.reduceWithIndex,ge=Gt.compact,_e=Gt.separate},function(t,e,n){"use strict";var r=n(15).config,i=(n(15).configure,n(7).objectOrFunction),o=n(7).isFunction,u=(n(7).now,n(27).cast),a=n(28).all,s=n(29).race,c=n(30).resolve,f=n(31).reject,l=n(32).asap;function d(t){if(!o(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof d))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],function(t,e){function n(t){k(e,t)}try{t((function(t){y(e,t)}),n)}catch(t){n(t)}}(t,this)}function p(t,e,n,r){var i,u,a,s,c=o(n);if(c)try{i=n(r),a=!0}catch(t){s=!0,u=t}else i=r,a=!0;_(e,i)||(c&&a?y(e,i):s?k(e,u):t===h?y(e,i):t===v&&k(e,i))}r.async=l;var h=1,v=2;function m(t,e,n,r){var i=t._subscribers,o=i.length;i[o]=e,i[o+h]=n,i[o+v]=r}function g(t,e){for(var n=t._subscribers,r=t._detail,i=0;i<n.length;i+=3)p(e,n[i],n[i+e],r);t._subscribers=null}function _(t,e){var n,r=null;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(i(e)&&(r=e.then,o(r)))return r.call(e,(function(r){if(n)return!0;n=!0,e!==r?y(t,r):b(t,r)}),(function(e){if(n)return!0;n=!0,k(t,e)})),!0}catch(e){return n||k(t,e),!0}return!1}function y(t,e){t===e?b(t,e):_(t,e)||b(t,e)}function b(t,e){void 0===t._state&&(t._state=0,t._detail=e,r.async(w,t))}function k(t,e){void 0===t._state&&(t._state=0,t._detail=e,r.async(S,t))}function w(t){g(t,t._state=h)}function S(t){g(t,t._state=v)}d.prototype={constructor:d,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var n=this,i=new this.constructor((function(){}));if(this._state){var o=arguments;r.async((function(){p(n._state,i,o[n._state-1],n._detail)}))}else m(this,i,t,e);return i},catch:function(t){return this.then(null,t)}},d.all=a,d.cast=u,d.race=s,d.resolve=c,d.reject=f,e.Promise=d},function(t,e,n){"use strict";var r={instrument:!1};e.config=r,e.configure=function(t,e){if(2!==arguments.length)return r[t];r[t]=e}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveEventsCache=e.EVENTS_CACHE_KEY=void 0;var r=n(8),i=n(1),o=n(0),u=n(39),a=n(2),s=n(44),c=n(6);e.EVENTS_CACHE_KEY="permutive-events-cache";var f=function(){function n(e,n){this.state=e,this._internals=n,this.EVENTS_CACHE_OBJECT_STORE="events",this.CRYPTO_KEY_OBJECT_STORE="keys",this.CRYPTO_KEY_OBJECT_KEY="events",this.lastRefreshed=null,this.eventPutQueue=t.resolve(),this.eventObjectCache=[],this.eventCacheSizeInBytes=0,this.retrieveLastRefreshTime(),this.eventStore=new u.EventsCacheStore(this._internals,new s.AESCrypto,"e488cdb0-e7cb-4d91-9648-60d437d8e491",this.EVENTS_CACHE_OBJECT_STORE+"_"+this.state.userId,this.CRYPTO_KEY_OBJECT_STORE+"_"+this.state.userId,this.CRYPTO_KEY_OBJECT_KEY,2)}return n.prototype.all=function(){return this.eventObjectCache},n.prototype.add=function(t,e){void 0===e&&(e=!0);for(var n=!1,r=0;r<this.eventObjectCache.length;r++)if(this.eventObjectCache[r].id===t.id){n=!0;break}return n?t=void 0:(this.eventObjectCache.push(t),e&&this.write()),t},n.prototype.processCachedEvents=function(t){for(var e=[],n=0;n<t.length;n++){var i=r.deserializeEvent(t[n]);e.push(i),this.add(i,!1)}return e},n.prototype.load=function(){var n=this;return this.eventStore.migrateIfRequired()().then(i.fold((function(t){return n._internals.network.error("Failed to migrate events cache. Got "+JSON.stringify(t)),n.reset().then((function(t){return[]}))}),(function(){var r=n._internals.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{});return n.eventStore.get(e.EVENTS_CACHE_KEY)().then((function(e){return n._internals.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",r),i.fold((function(t){return n._internals.network.error("Error fetching data from store. Got "+t),n.reset().then((function(t){return[]}))}),o.fold((function(){return t.resolve([])}),(function(e){return a.pipe(n.eventCacheSizeInBytes=2*JSON.stringify(e).length,(function(t){n._internals.metrics.track({name:"sdk_events_cache_byte_total",value:n.eventCacheSizeInBytes,labels:{}}),n._internals.metrics.track({name:"sdk_events_cache_size_total",value:e.length,labels:{}})}),(function(n){return t.resolve(e)}))})))(e)}))})))},n.prototype.refresh=function(t){return void 0===t&&(t={processImmediately:!1}),t.from||(t.from=this.getRefreshFromTime(),this.lastRefreshed=t.from,this.storeLastRefreshTime()),this._internals.log("refreshing from: ",t.from),this._internals.api.events(this._internals.state.userId,{error:t.error,from:t.from})},n.prototype.processRefreshEvents=function(t,e){void 0===e&&(e={});for(var n=[],i=t||[],o=0;o<i.length;o++){var u=this.add(r.deserializeEvent(i[o]),!1);u&&n.push(u)}if(i.length>0){var a=new Date(i[i.length-1].time);a.setMilliseconds(a.getMilliseconds()+1),this.lastRefreshed=a,this.storeLastRefreshTime()}return this._internals.log("events from api: ",i),this._internals.log("new events from api: ",n),this._internals.log("events cache",this.eventObjectCache),n.length>0&&e.write&&this.write(),n},n.prototype.reset=function(){var t=this;return this._internals.log("Resetting Events Cache"),this.eventObjectCache=[],this.eventCacheSizeInBytes=0,this.lastRefreshed=null,this.eventStore.deleteStore()().then((function(){t.eventStore=new u.EventsCacheStore(t._internals,new s.AESCrypto,"e488cdb0-e7cb-4d91-9648-60d437d8e491",t.EVENTS_CACHE_OBJECT_STORE+"_"+t.state.userId,t.CRYPTO_KEY_OBJECT_STORE+"_"+t.state.userId,t.CRYPTO_KEY_OBJECT_KEY,2)}))},n.prototype.write=function(t){var n=this;void 0===t&&(t=this.eventObjectCache);for(var i=JSON.stringify(t),o=1;t.length>0&&i.length>this._internals.config.eventsCacheLimitBytes/2;)t.splice(0,o),o*=2,i=JSON.stringify(t);this._internals.log("Writing cache (#e)",t.length),this.eventCacheSizeInBytes=2*i.length,this.eventPutQueue=this.eventPutQueue.then((function(i){return n.eventStore.put(t.map(r.serializeEvent),e.EVENTS_CACHE_KEY)().then(c.constVoid)}))},n.prototype.setRefreshFromTime=function(t){this.lastRefreshed=t,this.storeLastRefreshTime()},n.prototype.getRefreshFromTime=function(){var t=this.lastRefreshed||new Date(0);return t.setMilliseconds(t.getMilliseconds()+1),t},n.prototype.storeLastRefreshTime=function(){this.state.setPermutiveData("last_refresh_time",this.lastRefreshed.toISOString())},n.prototype.getStateSizeInBytes=function(){return this.eventCacheSizeInBytes},n.prototype.retrieveLastRefreshTime=function(){var t=this.state.getPermutiveData("last_refresh_time")||null;t&&(this.lastRefreshed=new Date(t))},n}();e.PermutiveEventsCache=f}).call(this,n(3).Promise)},function(t,e,n){"use strict";n.r(e),n.d(e,"URI",(function(){return i})),n.d(e,"fromEquals",(function(){return o})),n.d(e,"eqStrict",(function(){return u})),n.d(e,"strictEqual",(function(){return a})),n.d(e,"eqString",(function(){return s})),n.d(e,"eqNumber",(function(){return c})),n.d(e,"eqBoolean",(function(){return f})),n.d(e,"getStructEq",(function(){return l})),n.d(e,"getTupleEq",(function(){return d})),n.d(e,"eq",(function(){return p})),n.d(e,"contramap",(function(){return h})),n.d(e,"eqDate",(function(){return v})),n.d(e,"getMonoid",(function(){return g}));var r=n(2),i="Eq";function o(t){return{equals:function(e,n){return e===n||t(e,n)}}}var u={equals:a};function a(t,e){return t===e}var s=u,c=u,f=u;function l(t){return o((function(e,n){for(var r in t)if(!t[r].equals(e[r],n[r]))return!1;return!0}))}function d(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o((function(e,n){return t.every((function(t,r){return t.equals(e[r],n[r])}))}))}var p={URI:i,contramap:function(t,e){return o((function(n,r){return t.equals(e(n),e(r))}))}},h=Object(r.pipeable)(p).contramap,v=p.contramap(c,(function(t){return t.valueOf()})),m={equals:function(){return!0}};function g(){return{concat:function(t,e){return o((function(n,r){return t.equals(n,r)&&e.equals(n,r)}))},empty:m}}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u};Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalEnricher=e.SingleEnricher=void 0;var o=function(){};e.SingleEnricher=o;var u=function(){function t(){this.replacementMap={}}return t.prototype.register=function(t){this.replacementMap=r(r({},this.replacementMap),t.replacementMap)},t.prototype.enrich=function(t){for(var e=[{},!0],n=0;n<Object.keys(t[0]).length;n++){var r=Object.keys(t[0])[n],o=t[0][r];switch(!0){case"string"==typeof o&&"$"===o[0]:var u=i(this.isPropertyReplaceable(o),2),a=u[0],s=u[1];e[0][r]=a?s:o,e[1]=!!a&&e[1];break;case null!==o&&"object"==typeof o&&o.constructor===Object:var c=this.enrich([o,e[1]]);e[0][r]=c[0],e[1]=e[1]&&c[1];break;default:e[0][r]=o}}return e},t.prototype.isPropertyReplaceable=function(t){var e=this.replacementMap[t];return[this.replacementMap.hasOwnProperty(t)&&e!==t,e]},t}();e.GlobalEnricher=u},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.WebAddon=e.load=void 0;var i=n(4),o=n(0),u=["mousemove","click","scroll"],a=["email","tel","submit","reset","button","file","password","radio","checkbox"];e.load=function(t,e,n){0};var s=function(){function t(t){var e=this;this.dirtyState=!1,this.initialised=!1,this.totalCompletion=0,this.totalEngagedTime=0,this.trackPageviewEngagement="boolean"!=typeof{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_pageview_engagement||{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_pageview_engagement,this.trackPageviewEngagementAggregate="boolean"==typeof{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_aggregate_pageview_engagement&&{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_aggregate_pageview_engagement,this.trackFormSubmission="boolean"!=typeof{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_form_submission||{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_form_submission,this.trackLinkClick="boolean"!=typeof{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_link_click||{add_alchemy_entities:!1,add_alchemy_taxonomy:!1,auto_init:!1}.track_link_click,this.aggregateTimeoutDuration=3e5,this.hasAggregateFired=!1,this.permutive=t.permutive,this._internals=t._internals,this.context=t.context,this.eventInterval=t.eventInterval||5,this.page=t.page||{},this.sendPageviewEvent(),(t.dirtyEvents||u).map((function(t){window.addEventListener(t,(function(){e.dirtyState=!0,e.trackPageviewEngagementAggregate&&e.resetTimeout()}))})),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners,!1),this.trackPageviewEngagement&&(this.timerHandle=this.registerEngagementInterval(this.eventInterval)),this.trackPageviewEngagementAggregate&&(this.setAggregateTimeout(this.aggregateTimeoutDuration),i.onPageUnload((function(){return e.hasAggregateFired?null:e.sendAggregateEvent(e.totalEngagedTime,e.totalCompletion)}))),this.initialised=!0}return t.prototype.sendPageviewEvent=function(){var t=this,e=r(r(r(r({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},{}),{}),this.enrichmentProperties(this.context.isArticle)),this.page?this.page:{}),n={success:function(){t.initialised||t._internals.metrics.trackTimeSinceInit("sdk_first_event_tracked_task_duration_seconds",{})}};this.permutive.track("Pageview",e,n)},t.prototype.sendLinkClickEvent=function(t,e){if(window.location.href&&t.href){var n=0===t.href.indexOf("data:")?"NOT_URL":t.href;this.permutive.track("LinkClick",{dest_url:n},{useBeacon:e})}},t.prototype.sendFormSubmissionEvent=function(t){var e=t.currentTarget,n={form:r(r(r({method:e.method||"GET",properties:this.serializeForm(e)},"string"==typeof e.id?{id:e.id}:{}),e.name&&"string"==typeof e.name?{name:e.name}:{}),e.action&&"string"==typeof e.action?{action:e.action}:{})};this.permutive.track("FormSubmission",n)},t.prototype.sendEngagementEvent=function(t){var e=this.updateState(t),n=e.engaged_time,i=e.total_engaged_time,o=e.completion,u=e.total_completion,a=r(r(r({engaged_time:n,total_engaged_time:i},this.page),{completion:o,total_completion:u}),{});this.permutive.track("PageviewEngagement",a)},t.prototype.sendAggregateEvent=function(t,e,n){void 0===n&&(n=!0);var i=r({total_engaged_time:t},{total_completion:e});this.permutive.track("PageviewEngagementAggregate",i,{useBeacon:n}),this.hasAggregateFired=!0},t.prototype.reset=function(t){this._internals.state.viewId=i.uuidv4(),this.page=t.page||null,this.totalCompletion=0,this.totalEngagedTime=0,this.sendPageviewEvent(),this.trackPageviewEngagement&&(clearInterval(this.timerHandle),this.timerHandle=this.registerEngagementInterval(this.eventInterval))},t.prototype.serializeForm=function(t){return[].slice.call(t.getElementsByTagName("input"),0).filter((function(t){return!(!t.type||!t.id||t.disabled||t.checked||"fieldset"===t.nodeName.toLowerCase()||-1!==a.indexOf(t.type.toLowerCase()))})).map((function(t){return{name:t.name||t.id,value:t.value}})).filter((function(t){return t.value.length<120}))},t.prototype.enrichmentProperties=function(t){return r(r(r({},{}),{}),{})},t.prototype.registerEngagementInterval=function(t){var e=this;return setInterval((function(){e.dirtyState&&e.sendEngagementEvent(t)}),1e3*t)},t.prototype.attachListeners=function(){var t=this,e=function(t){return"a"===t.tagName.toLowerCase()},n=function(t){return e(t)?o.some(t):t.parentElement?e(t.parentElement)?o.some(t.parentElement):n(t.parentElement):o.none};this.trackFormSubmission&&[].slice.call(document.getElementsByTagName("form"),0).forEach((function(e){e.addEventListener("submit",t._internals.makeSafe(t.sendFormSubmissionEvent.bind(t)))})),this.trackLinkClick&&document.body.addEventListener("click",(function(e){if(e.target instanceof Element){var r=n(e.target);return o.fold((function(){}),(function(n){return t.sendLinkClickEvent(n,function(t,e){return!("_blank"===e.target||t.metaKey||t.ctrlKey||t.shiftKey||2===t.which||3===t.which)}(e,n))}))(r)}}))},t.prototype.updateState=function(t){var e=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=e-this.totalCompletion;return this.totalEngagedTime+=t,this.totalCompletion=e,this.dirtyState=!1,{engaged_time:t,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}},t.prototype.getCurrentCompletion=function(){var t=document.documentElement.scrollHeight,e=window.pageYOffset+window.innerHeight;return e<=0?0:e>=t?1:e/t},t.prototype.setAggregateTimeout=function(t){var e=this;return window.setTimeout((function(){return e.sendAggregateEvent(e.totalEngagedTime,e.totalCompletion,!1)}),t)},t.prototype.resetTimeout=function(){clearTimeout(this.aggregateTimeoutHandle),this.aggregateTimeoutHandle=this.setAggregateTimeout(this.aggregateTimeoutDuration)},t}();e.WebAddon=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OverlaysAddon=e.load=void 0,e.load=function(t,e,n){t.unshift({functionName:"addon",arguments:["overlays",{}]})};var r=function(){function t(t){var e=this,n=this;this.permutive=t.permutive,this._internals=t._internals,this.reactions=this._internals.state.reactionManager.getReactions("show_overlay"),this.loadedImageCounts={};for(var r=function(t){var r=i.reactions[t],o=r.config,u=i.buildOverlayCss(o,t);document.head.insertAdjacentHTML("beforeend",u);var a=i.buildOverlayBody(o,t);document.body.insertAdjacentHTML("beforeend",a);var s="permutive-overlay-"+t,c=document.getElementById(s),f=c.getElementsByClassName("close")[0],l=c.getElementsByClassName("content")[0],d=function(){c.style.visibility="hidden",c.style.opacity="0"},p=function(t){l.contains(t.target)||(d(),c.removeEventListener("click",p))};f.addEventListener("click",d),c.addEventListener("click",p),[].slice.call(c.getElementsByTagName("a")).slice(1).forEach((function(t){t.addEventListener("click",(function(){r.trackConversion({useBeacon:!0})}))}));var h=c.getElementsByTagName("form")[0];h&&h.addEventListener("submit",(function(t){t.preventDefault(),r.trackConversion({success:function(){h.submit()}})}));var v=function(t,e){n.showOverlay(t),e.trackImpression()};r.reactEveryTime()?i.permutive.query(r.segmentCode,i._internals.makeSafe((function(t){t.result?v(s,r):e.permutive.trigger(r.segmentCode,"result",(function(t){t.result&&v(s,r)}))}))):r.reactOnEntry()?i.permutive.trigger(r.segmentCode,"result",i._internals.makeSafe((function(t){t.result&&v(s,r)}))):r.reactOnExit()&&i.permutive.trigger(r.segmentCode,"result",i._internals.makeSafe((function(t){t.result||v(s,r)})))},i=this,o=0;o<this.reactions.length;o++)r(o)}return t.prototype.buildOverlayCss=function(t,e){return'<style type="text/css">.${overlay_class}{position:fixed;top:0;bottom:0;left:0;right:0;width:100%;height:100%;background:rgba(0,0,0,0.${opacity_percentage});transition:opacity ${opacity_transition_ms}ms;visibility:hidden;opacity:0;z-index:1000000;}.${modal_class}{position:fixed;padding:10px;background:#fff;border-radius:5px;z-index:1000001}.${modal_class} .content{overflow:auto;z-index:1000002;}.${modal_class} .close{position:absolute;top:20px;right:30px;transition:all 200ms;font-size:30px;font-weight:bold;text-decoration:none;color:#333;z-index:1000003}.${modal_class} .close:hover{color:orange;}</style>'.replace(/\${overlay_class}/g,"permutive-overlay-"+e).replace(/\${modal_class}/g,"permutive-modal-"+e).replace("${opacity_percentage}",t.opacity_percentage.toString()).replace("${opacity_transition_ms}",t.opacity_transition_ms.toString())},t.prototype.buildOverlayBody=function(t,e){var n="";return!function(t){return void 0!==t.html}(t)?function(t){return void 0!==t.image_url&&void 0!==t.image_link}(t)&&(n='<a href="'+t.image_link+'"><img src="'+t.image_url+'"/></a>'):n=t.html,'<div id="${overlay_class}" class="${overlay_class}"><div id="${modal_class}" class="${modal_class}"><a class="close" href="javascript:;">&times;</a><div class="content">${content}</div></div></div>'.replace(/\${overlay_class}/g,"permutive-overlay-"+e).replace(/\${modal_class}/g,"permutive-modal-"+e).replace("${content}",n).replace(/<img /g,"<img onload='window.permutive.addons.overlays.loadedImage(\"permutive-overlay-"+e+"\")' ")},t.prototype.showOverlay=function(t){var e=this,n=document.getElementById(""+t),r=function(){var t=n.getElementsByTagName("div")[0],e=t.getBoundingClientRect().height,r=t.getBoundingClientRect().width;t.style.left=window.innerWidth/2-r/2+"px",t.style.top=window.innerHeight/2-e/2+"px",n.style.visibility="visible",n.style.opacity="1"},i=n.getElementsByTagName("img");if(i.length>0){var o=0,u=function(){o<10&&(!(t in e.loadedImageCounts)||e.loadedImageCounts[t]<i.length)?(o+=1,setTimeout(u,500)):r()};u()}else r()},t.prototype.loadedImage=function(t){t in this.loadedImageCounts?this.loadedImageCounts[t]=this.loadedImageCounts[t]+1:this.loadedImageCounts[t]=1},t}();e.OverlaysAddon=r},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScriptRunnerAddon=exports.load=void 0,exports.load=function(t,e,n){t.unshift({functionName:"addon",arguments:["scriptrunner",{}]})};var ScriptRunnerAddon=function(){function ScriptRunnerAddon(options){var _this=this;this.permutive=options.permutive,this._internals=options._internals,this.network=options.network,this.reactions=this._internals.state.reactionManager.getReactions("run_script");for(var _loop_1=function(i){var reaction=this_1.reactions[i],run_1=function(reaction){var script=reaction.config.script.replace(/impression\(\)/g,"reaction.trackImpression();").replace(/conversion\(\)/g,"reaction.trackConversion();");try{eval(script)}catch(t){t.message="Error running custom script: "+t.message,_this.network.error(t,_this._internals.state.userId)}};reaction.reactEveryTime()?this_1.permutive.query(reaction.segmentCode,(function(t){t.result?run_1(reaction):_this.permutive.trigger(reaction.segmentCode,"result",(function(t){t.result&&run_1(reaction)}))})):reaction.reactOnEntry()?this_1.permutive.trigger(reaction.segmentCode,"result",(function(t){t.result&&run_1(reaction)})):reaction.reactOnExit()&&this_1.permutive.trigger(reaction.segmentCode,"result",(function(t){t.result||run_1(reaction)}))},this_1=this,i=0;i<this.reactions.length;i++)_loop_1(i)}return ScriptRunnerAddon}();exports.ScriptRunnerAddon=ScriptRunnerAddon},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(9),i=n(1),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t){var e=Object(r.a)(t,i.either);return o(o({},e),{chain:function(e,n){return t.chain(e,(function(e){return Object(i.isLeft)(e)?t.of(Object(i.left)(e.left)):n(e.right)}))},alt:function(n,r){return t.chain(n,(function(t){return Object(i.isLeft)(t)?r():e.of(t.right)}))},bimap:function(e,n,r){return t.map(e,(function(t){return i.either.bimap(t,n,r)}))},mapLeft:function(e,n){return t.map(e,(function(t){return i.either.mapLeft(t,n)}))},fold:function(e,n,r){return t.chain(e,Object(i.fold)(n,r))},getOrElse:function(e,n){return t.chain(e,Object(i.fold)(n,t.of))},orElse:function(n,r){return t.chain(n,Object(i.fold)(r,(function(t){return e.of(t)})))},swap:function(e){return t.map(e,i.swap)},rightM:function(e){return t.map(e,i.right)},leftM:function(e){return t.map(e,i.left)},left:function(e){return t.of(Object(i.left)(e))}})}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(9),i=n(1),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e){var n=Object(r.a)(e,Object(i.getValidation)(t));return o(o({},n),{chain:function(t,n){return e.chain(t,(function(t){return Object(i.isLeft)(t)?e.of(Object(i.left)(t.left)):n(t.right)}))},alt:function(r,o){return e.chain(r,(function(r){return Object(i.isRight)(r)?n.of(r.right):e.map(o(),(function(e){return Object(i.isLeft)(e)?Object(i.left)(t.concat(r.left,e.left)):e}))}))}})}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(10),i=n(0),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};var u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var n=u(u({},function(t,e){var n=Object(r.a)(t,e),u=o(o({},n),{compact:function(n){return t.map(n,e.compact)},separate:function(t){return{left:u.compact(n.map(t,i.getLeft)),right:u.compact(n.map(t,i.getRight))}}});return u}(t,e)),{partitionMap:function(t,e){return{left:n.filterMap(t,(function(t){return Object(i.getLeft)(e(t))})),right:n.filterMap(t,(function(t){return Object(i.getRight)(e(t))}))}},partition:function(t,e){return{left:n.filter(t,(function(t){return!e(t)})),right:n.filter(t,e)}},filterMap:function(n,r){return t.map(n,(function(t){return e.filterMap(t,r)}))},filter:function(n,r){return t.map(n,(function(t){return e.filter(t,r)}))}});return n}},function(module,exports,__webpack_require__){"use strict";(function(Promise){var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},__read=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasConsent=exports.consent=exports.makeConfig=exports.getTag=exports.canRun=void 0;var PermutiveNetwork_1=__webpack_require__(35),PermutiveState_1=__webpack_require__(36),PermutiveUtils_1=__webpack_require__(4),PermutiveIdentities_1=__webpack_require__(12),PermutiveInternals_1=__webpack_require__(46),PermutiveMetrics_1=__webpack_require__(54),PermutiveThirdParty_1=__webpack_require__(55),PermutiveMethods_1=__webpack_require__(57),GraphQLIdentify_1=__webpack_require__(59),GraphQLEvents_1=__webpack_require__(60),Config_1=__webpack_require__(61),QueryManager_1=__webpack_require__(62),Option_1=__webpack_require__(0),Either_1=__webpack_require__(1),Apply_1=__webpack_require__(64),pipeable_1=__webpack_require__(2),Array_1=__webpack_require__(13),Eq_1=__webpack_require__(18),TaskEither_1=__webpack_require__(11),Task_1=__webpack_require__(5),function_1=__webpack_require__(6),sdkInitTimestamp=window.performance.now();exports.canRun=function(t){var e=t.Worker&&t.Blob?Either_1.right(null):Either_1.left("WebWorkers not supported"),n=["QuotaExceededError","QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED"],r=Either_1.tryCatch((function(){t.localStorage.setItem("_permutive_ls_test","_permutive_ls_test"),t.localStorage.removeItem("_permutive_ls_test")}),(function(e){return t.localStorage&&0===t.localStorage.remainingSpace||n.some((function(t){return-1!==String(e).indexOf(t)}))?"localStorage quota exceeded":"localStorage not supported"}));return pipeable_1.pipe(Apply_1.sequenceT(Either_1.either)(r,e),(function(e){return TaskEither_1.map((function(e){return t}))(TaskEither_1.fromEither(e))}))},exports.getTag=function(t){return pipeable_1.pipe(Either_1.fromNullable("Can't find permutive tag on the page")(t.permutive),TaskEither_1.fromEither)},exports.makeConfig=function(t){return TaskEither_1.right(__assign(__assign({},t),{config:Config_1.make(t.config)}))};var makeNetwork=function(t){return TaskEither_1.right([t,new PermutiveNetwork_1.PermutiveNetwork(t.config)])};exports.consent=function(t){return"object"==typeof t&&pipeable_1.pipe(window.localStorage.setItem("permutive-consent",JSON.stringify(t)),(function(e){return t.opt_in&&null!==t.token&&t.token.length>0}))},exports.hasConsent=function(t){var e,n=__read(t,2),r=n[0],i=n[1],o=TaskEither_1.getOrElse((function(t){return TaskEither_1.getOrElse((function(t){return TaskEither_1.getOrElse((function(t){return Task_1.of(!1)}))(Array_1.elem(Eq_1.eqString)(r.config.projectId,["fe68d1f7-c9f4-45b3-8905-7cda73d3fd74"])?TaskEither_1.tryCatch((function(){return i.req({url:i.getEndpointUrl("/geoip"),method:"GET"},!1).then((function(t){return"Israel"===PermutiveUtils_1.lens(t,"geo_info","country")&&exports.consent({opt_in:!0,token:"whitelisted-geo"})}))}),(function(t){return i.error("Failed to retrieve geo location information required for consent. Got "+t)})):TaskEither_1.right(!0))}))(TaskEither_1.fromOption(function_1.constVoid)((e=JSON.parse(window.localStorage.getItem("permutive-consent")))?Option_1.some(exports.consent(e)):Option_1.none));var e}))(TaskEither_1.fromOption(function_1.constVoid)((e=Array_1.findFirst((function(t){return"consent"===t.functionName}))(r.q),Option_1.map((function(t){return exports.consent(t.arguments[0])}))(e))));return Task_1.map((function(t){return t?Either_1.right(function_1.tuple(PermutiveUtils_1.mergeObjects(__assign({},r),{consent:exports.consent}),i)):Either_1.left("No consent to run on the page")}))(o)};var init=function(tagAndNetwork){return TaskEither_1.tryCatch((function(){var _a=__read(tagAndNetwork,2),tag=_a[0],network=_a[1],context=PermutiveUtils_1.mergeObjects(tag.context||{},{path:window.location.pathname,url:window.location.href,referrer:document.referrer}),_internals=new PermutiveInternals_1.PermutiveInternals(tag.config,network),permutiveMethods=new PermutiveMethods_1.PermutiveMethods(_internals,network,context);_internals.state=new PermutiveState_1.PermutiveState(_internals,permutiveMethods,context),_internals.queryManager=new QueryManager_1.QueryManager(_internals,permutiveMethods,network),_internals.thirdParty=new PermutiveThirdParty_1.PermutiveThirdParty(_internals,permutiveMethods,network),_internals.identities=new PermutiveIdentities_1.PermutiveIdentities(_internals,network);var isMetricsUser=_internals.state.getPermutiveData("metricsEnabled");_internals.metrics=!0===isMetricsUser?new PermutiveMetrics_1.PermutiveMetrics(sdkInitTimestamp,_internals,permutiveMethods):!1===isMetricsUser?new PermutiveMetrics_1.PermutiveMetricsNoOp:pipeable_1.pipe(Math.random()<=_internals.config.metricsSamplingPercentage/100,(function(t){return[_internals.state.setPermutiveData("metricsEnabled",t),t]}),(function(t){var e=__read(t,2);e[0];return e[1]?new PermutiveMetrics_1.PermutiveMetrics(sdkInitTimestamp,_internals,permutiveMethods):new PermutiveMetrics_1.PermutiveMetricsNoOp}));var permutiveShell=PermutiveUtils_1.mergeObjects(tag,{q:window.permutive.q},{context:context},{addons:_internals.addons});[].forEach((function(s){try{eval(s)}catch(t){network.error(__assign(__assign({},t),{message:"Error running custom script "+s}),_internals.state.userId)}})),_internals.addBlocker("permutive:queries:initialised"),_internals.messages.on("permutive:blockers:empty",(function(){var t=PermutiveUtils_1.mergeObjects(permutiveShell,{identify:permutiveMethods.identify.bind(permutiveMethods),on:permutiveMethods.on.bind(permutiveMethods),once:permutiveMethods.once.bind(permutiveMethods),track:permutiveMethods.track.bind(permutiveMethods),trigger:permutiveMethods.trigger.bind(permutiveMethods),query:permutiveMethods.query.bind(permutiveMethods),segment:permutiveMethods.segment.bind(permutiveMethods),segments:permutiveMethods.segments.bind(permutiveMethods),reset:permutiveMethods.reset.bind(permutiveMethods),ready:permutiveMethods.ready.bind(permutiveMethods),addon:permutiveMethods.addon.bind(permutiveMethods)},Array_1.elem(Eq_1.eqString)("e488cdb0-e7cb-4d91-9648-60d437d8e491",["c8c3489e-f329-40e8-bcfc-1f852e512b01","be668577-07f5-444d-98e0-222b990951b1"])?{_internals:_internals}:{});_internals.setAsReady();var e=["identify","trigger","addon","track"];permutiveShell.q.filter((function(t){return"consent"!==t.functionName})).sort((function(t,n){var r=e.indexOf(t.functionName),i=e.indexOf(n.functionName);return-1===r?-1===i?0:1:-1===i?-1:r-i})).forEach((function(e){e.functionName in t?t[e.functionName].apply(permutiveMethods,e.arguments):network.error('Function "permutive.'+e.functionName+'" does not exist.',_internals.state.userId)})),window.permutive=__assign(__assign({},t),{q:[]})}));var aliasesMap=_internals.identities.currentAliases,aliasesList=_internals.identities.convertAliases(aliasesMap),retrieveThirdPartyIdentities=function(){return _internals.identities.retrieveAllIdentities()},resolveIdentity=function(){var t=PermutiveUtils_1.deferredPromise();_internals.log("<call> init identity "),permutiveShell.context.user_id=_internals.state.userId,permutiveShell.q.filter((function(t){return"identify"===t.functionName})).forEach((function(t){_internals.makeSafe((function(){var e=PermutiveIdentities_1.PermutiveIdentities.getAliasesFromIdentifyArg(t.arguments[0]);_internals.api.identify(e)}))()}));for(var e=function(){return PermutiveUtils_1.findIndex(permutiveShell.q,(function(t){return"identify"===t.functionName}))},n=e();n>0;)permutiveShell.q.splice(n,1),n=e();_internals.log("Starting identification... Current aliases are:",aliasesMap);var r=_internals.state.userId,i=new GraphQLIdentify_1.GraphQLIdentify(r,aliasesList);return _internals.graphql.register(i).then((function(e){return n={user_id:e.identity.identify.id},void((i=n.user_id)!==r?(_internals.log("Got different user id from API: "+i),_internals.state.reset().then((function(t){return pipeable_1.pipe(_internals.state.setUserId(i),(function(t){return _internals.identities.storeAliases(aliasesMap)}),(function(t){return _internals.state.eventsCache.reset()}))})).then((function(e){return t.resolve({identityChanged:!0,userId:i})}))):(_internals.identities.storeAliases(aliasesMap),t.resolve({identityChanged:!1,userId:i})));var n,i})).catch((function(){network.error("Couldn't set identity for user "+r,r),t.resolve({identityChanged:!1,userId:r})})),t.promise.then((function(t){_internals.messages.emit("permutive:user:ready"),_internals.setIdentityReady(),_internals.log("<done> init identity ",t)})),t.promise},onIdentityChanged=function(){return _internals.log("Identity has changed"),_internals.state.eventsCache.refresh({from:new Date(0)}).then((function(t){var e=_internals.state.eventsCache.processRefreshEvents(t,{write:!0});return _internals.log("Retrieved full event history from API"),_internals.queryManager.updateSegmentResults(e),_internals.queryManager.initWorker(e)}))},onIdentityRemained=function(t){return _internals.log("Identity hasn't changed"),_internals.state.eventsCache.load().then((function(t){_internals.log("Loaded local event cache");var e=_internals.state.eventsCache.processCachedEvents(t);return _internals.queryManager.initWorker(e)})).then((function(){return t})).then((function(t){var e=_internals.state.eventsCache.processRefreshEvents(t,{write:!0});return _internals.log("Updating query states with unseen events from API (#e)",e.length),_internals.queryManager.updateWithHistoricSegments(e)}))},loadAddon=function(t){return t.load(permutiveShell.q,permutiveMethods,_internals,network)},addons=__spread([],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[Promise.resolve().then((function(){return __webpack_require__(21)}))],[],[],[],[],[],[],[],[Promise.resolve().then((function(){return __webpack_require__(22)}))],[],[],[],[],[Promise.resolve().then((function(){return __webpack_require__(20)}))]);addons.forEach((function(t){return t.then(loadAddon)}));var registerEnricher=function(t){return t.register(_internals,permutiveShell.context,permutiveShell.config)},enrichers=__spread([Promise.resolve().then((function(){return __webpack_require__(65)}))],[]);enrichers.forEach((function(t){return t.then(registerEnricher)}));var registerIdentityPovider=function(t){return t.register(_internals,network)},identityProviders=__spread([],[],[]);return Promise.all(identityProviders).then((function(t){return t.forEach(registerIdentityPovider)})).then((function(t){return retrieveThirdPartyIdentities()})).then((function(){_internals.thirdParty.segments();var t=resolveIdentity(),e=_internals.state.eventsCache.getRefreshFromTime(),n=_internals.graphql.register(new GraphQLEvents_1.GraphQLEvents(_internals.state.userId,e));return _internals.graphql.run(),t.then((function(t){return t.identityChanged?onIdentityChanged():(_internals.state.eventsCache.lastRefreshed=e,_internals.state.eventsCache.storeLastRefreshTime(),onIdentityRemained(n.then((function(t){return t.events})).catch((function(t){return network.error("Identity retrieval failed with reason: "+t,_internals.state.userId),t}))))}))})).then((function(){return PermutiveIdentities_1.hasBrokenIdentity("e488cdb0-e7cb-4d91-9648-60d437d8e491",aliasesList.map((function(t){return t.id})),window.location.hostname,_internals.state.userId)?permutiveMethods.reset():Promise.resolve()})).then((function(){return Promise.all([_internals.thirdParty.segments(),_internals.models.getModels()]).then((function(t){return _internals.log("Loaded TPD segments and lookalike models",t),_internals.queryManager.updateEnvironment({segments:PermutiveUtils_1.mergeObjects({"1p":_internals.queryManager.userSegmentsDict},t[0]),lookalikeModels:t[1]})}))})).then((function(){_internals.queryManager.setAsReady(),_internals.messages.emit("permutive:api:ready"),_internals.metrics.track({name:"sdk_local_storage_byte_total",value:_internals.state.getStateSizeInBytes(),labels:{}}),_internals.metrics.track({name:"sdk_query_states_byte_total",value:_internals.queryManager.getStateSizeInBytes(),labels:{}})}))}),(function(t){return"Exception during initialisation. Got "+t}))},initialisationSequence=pipeable_1.pipe(TaskEither_1.right(window),TaskEither_1.chain(exports.canRun),TaskEither_1.chain(exports.getTag),TaskEither_1.chain(exports.makeConfig),TaskEither_1.chain(makeNetwork),TaskEither_1.chain(exports.hasConsent),TaskEither_1.chain(init));initialisationSequence().then(Either_1.fold((function(t){return console.error("Error while initialising permutive. "+t)}),function_1.constVoid))}).call(this,__webpack_require__(3).Promise)},function(t,e,n){"use strict";e.cast=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))}},function(t,e,n){"use strict";var r=n(7).isArray,i=n(7).isFunction;e.all=function(t){if(!r(t))throw new TypeError("You must pass an array to all.");return new this((function(e,n){var r,o=[],u=t.length;function a(t){return function(e){s(t,e)}}function s(t,n){o[t]=n,0==--u&&e(o)}0===u&&e([]);for(var c=0;c<t.length;c++)(r=t[c])&&i(r.then)?r.then(a(c),n):s(c,r)}))}},function(t,e,n){"use strict";var r=n(7).isArray;e.race=function(t){if(!r(t))throw new TypeError("You must pass an array to race.");return new this((function(e,n){for(var r,i=0;i<t.length;i++)(r=t[i])&&"function"==typeof r.then?r.then(e,n):e(r)}))}},function(t,e,n){"use strict";e.resolve=function(t){return new this((function(e,n){e(t)}))}},function(t,e,n){"use strict";e.reject=function(t){return new this((function(e,n){n(t)}))}},function(t,e,n){"use strict";(function(t,n){var r="undefined"!=typeof window?window:{},i=r.MutationObserver||r.WebKitMutationObserver,o=void 0!==t?t:void 0===this?window:this;var u,a,s,c,f=[];function l(){for(var t=0;t<f.length;t++){var e=f[t];(0,e[0])(e[1])}f=[]}void 0!==n&&"[object process]"==={}.toString.call(n)?u=function(){n.nextTick(l)}:i?(a=0,s=new i(l),c=document.createTextNode(""),s.observe(c,{characterData:!0}),u=function(){c.data=a=++a%2}):u=function(){o.setTimeout(l,1)},e.asap=function(t,e){1===f.push([t,e])&&u()}}).call(this,n(16),n(33))},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(t){r=u}}();var s,c=[],f=!1,l=-1;function d(){f&&s&&(f=!1,s.length?c=s.concat(c):l=-1,c.length&&p())}function p(){if(!f){var t=a(d);f=!0;for(var e=c.length;e;){for(s=c,c=[];++l<e;)s&&s[l].run();l=-1,e=c.length}s=null,f=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new h(t,e)),1!==c.length||f||a(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";(function(t){var r=n(14).Promise,i=n(7).isFunction;e.polyfill=function(){var e,n;"Promise"in(e=void 0!==t?t:"undefined"!=typeof window&&window.document?window:self)&&"cast"in e.Promise&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&(new e.Promise((function(t){n=t})),i(n))||(e.Promise=r)}}).call(this,n(16))},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveNetwork=void 0;var n=function(){function e(t){this.config=t,this.clientErrorsSent=0}return e.prototype.getEndpointUrl=function(t){return this.config.apiProtocol+"://"+this.config.apiHost+"/"+this.config.apiVersion+t},e.prototype.req=function(e,n){var r=-1===e.url.indexOf("?")?"?":"&",i=""+e.url+r+"k="+this.config.apiKey,o=e.method||"GET",u=e.data?JSON.stringify(e.data):"",a=e.contentType?e.contentType:"application/json";if(n&&navigator.sendBeacon){if(navigator.sendBeacon(i,u))return e.success&&e.success(u),t.resolve();var s="Failed to queue beacon";return e.error&&e.error(s),t.reject(s)}return this.ajax({type:o,url:i,contentType:a,dataType:e.dataType?e.dataType:"json",data:u,timeout:this.config.requestTimeout,xhrFields:e.xhrFields}).then((function(t){return e.success&&e.success(t),t}),(function(t){return e.error&&e.error(t),null}))},e.prototype.ajax=function(e){var n=this;return new t((function(t,r){var i,o,u={},a=e.dataType?e.dataType:"json",s=new XMLHttpRequest;if(e.contentType&&(i="Content-Type",o=e.contentType,u[i.toLowerCase()]=[i,o]),"binary"===e.dataType&&(s.responseType="arraybuffer"),s.onload=function(){404===this.status?r("Resource not found"):t("json"===a?this.responseText?JSON.parse(this.responseText):null:"text"===a?this.responseText:this.response)},s.onerror=function(){n.error("Failed AJAX request"),r(new TypeError("Network request failed"))},s.ontimeout=function(){n.error("AJAX request timed out"),r(new TypeError("Network request timed out"))},s.open(e.type?e.type:"GET",e.url,!0),e.timeout&&(s.timeout=e.timeout),e.xhrFields)for(var c in e.xhrFields)s[c]=e.xhrFields[c];Object.keys(u).forEach((function(t){var e=u[t];s.setRequestHeader(e[0],e[1])})),s.send(e.data?e.data:null)}))},e.prototype.error=function(t,e){if(this.config.sendClientErrors){if(this.clientErrorsSent>3)return;this.clientErrorsSent+=1;var n={user_id:e||"",domain:window.location.hostname?window.location.hostname:"",url:window.location.href?window.location.href:"",referrer:document.referrer?document.referrer:"",user_agent:navigator.userAgent?navigator.userAgent:"",error_message:"",stack_trace:"",additional_details:""};t instanceof Error?(void 0!==t.message&&(n.error_message=t.message.toString()),void 0!==t.stack&&(n.stack_trace=t.stack.toString())):n.additional_details=t.toString(),this.req({url:this.getEndpointUrl("/internal/errors"),method:"POST",data:n,contentType:"text/plain",dataType:"text"},!1)}else window.console&&(window.console.error?window.console.error("[Permutive]",t):window.console.log&&window.console.log("[Permutive]",t))},e}();e.PermutiveNetwork=n}).call(this,n(3).Promise)},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveState=void 0;var r=n(37),i=n(17),o=n(45),u=n(0),a=n(4),s=n(2),c=function(){function e(t,e,n){this._internals=t,this.permutive=e,this.context=n,this.taskQueue=new o.PermutiveTaskQueue(this._internals);var s=this._internals.getNamespacedStorageKey(t.config.permutiveDataKey),c=localStorage.getItem(s);this.permutiveDataByteSize=null===c?0:2*c.length,this.permutiveData=null===c?{}:JSON.parse(c);var f=u.fromNullable(this._internals.getCookie(this._internals.config.cookieName)),l=u.fromNullable(this._internals.getExternalData(this._internals.config.cookieName)),d=u.getOrElse((function(){return u.getOrElse(a.uuidv4)(l)}))(f);this.setUserId(d),this.viewId=a.uuidv4(),this.eventsCache=new i.PermutiveEventsCache(this,this._internals),this.reactionManager=new r.PermutiveReactionManager(this._internals,this.permutive,this.context),this.reactionManager.load()}return e.prototype.setUserId=function(t){this._internals.setCookie(this._internals.config.cookieName,t,!0),this._internals.setExternalData(this._internals.config.cookieName,t),this.userId=t},e.prototype.getPermutiveData=function(t){return this.permutiveData[t]},e.prototype.setPermutiveData=function(t,e){this.permutiveData[t]=e;var n=this._internals.getNamespacedStorageKey(this._internals.config.permutiveDataKey),r=JSON.stringify(this.permutiveData);this.permutiveDataByteSize=2*r.length,this._internals.makeSafe((function(){localStorage.setItem(n,r)}))()},e.prototype.getPageviewId=function(){return this.viewId},e.prototype.getClient=function(){var t="";return t=document.title?document.title:"",{type:"web",user_agent:navigator.userAgent||"",url:window.location.href||"",domain:window.location.hostname||"",title:t,referrer:document.referrer||""}},e.prototype.getStateSizeInBytes=function(){return this.permutiveDataByteSize+this.eventsCache.getStateSizeInBytes()},e.prototype.reset=function(){var e=this;return this._internals.log("Resetting State"),t.resolve(s.pipe(this._internals.deleteCookie(this._internals.config.cookieName),(function(t){return e._internals.removeExternalData(e._internals.config.cookieName)}),(function(t){return e.permutiveData={}}),(function(t){return e.permutiveDataByteSize=0}),(function(t){return localStorage.removeItem(e._internals.config.permutiveDataKey)})))},e}();e.PermutiveState=c}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveReactionManager=void 0;var r=n(4),i=n(38),o=function(){function t(t,e,n){this._internals=t,this.permutive=e,this.context=n,this.reactionsConfig=[],this.specializedReactionsConfig={target_dfp:{dfp:[],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{},appnexus_adserver:[],nativo:[]},this.reactions={}}return t.prototype.load=function(){for(var t=0;t<this.reactionsConfig.length;t++){var e=this.reactionsConfig[t];this.reactions[e.reaction_type]?this.reactions[e.reaction_type].push(e):this.reactions[e.reaction_type]=[e]}},t.prototype.evaluateContextCriteria=function(t){for(var e=this,n=function(t){var n=e.context[t.key];return void 0!==n&&("EQUALS"===t.comparison?n===t.value:"NOT_EQUALS"===t.comparison?n!==t.value:"CONTAINS"===t.comparison&&"string"==typeof n||Array.isArray(n)?n.indexOf(t.value)>=0:!!("NOT_CONTAINS"===t.comparison&&"string"==typeof n||Array.isArray(n))&&n.indexOf(t.value)<0)},r=0;r<t.criteria.length;r++){var i=n(t.criteria[r]);if("AND"===t.operator&&!i)return!1;if("OR"===t.operator&&i)return!0}return"AND"===t.operator},t.prototype.selectVariant=function(t,e){if(1===e.length)return e[0];var n=this._internals.state.userId+t,i=Math.abs(r.hash(n))%12e4;e.sort((function(t,e){return t.start_bucket-e.start_bucket}));var o=r.findIndex(e,(function(t){return i<t.start_bucket}));return e[o>=0?o-1:e.length-1]},t.prototype.getSpecializedReactions=function(t){return this.specializedReactionsConfig[t]},t.prototype.getReactions=function(t){var e=[];if(this.reactions[t])for(var n=0;n<this.reactions[t].length;n++){var r=this.reactions[t][n],o=this.selectVariant(r.id,r.variants);if(o){var u=o.context_criteria;u&&!this.evaluateContextCriteria(u)||e.push(new i.PermutiveReaction(this.permutive,this._internals,r.id,o.segment_code,"",r.reaction_type,r.trigger_type,o.id,o.config))}}return e},t}();e.PermutiveReactionManager=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveReaction=void 0;var r=function(){function t(t,e,n,r,i,o,u,a,s){this.permutive=t,this._internals=e,this.id=n,this.segmentCode=r,this.segmentName=i,this.reactionType=o,this.triggerType=u,this.variantId=a,this.config=s}return t.prototype.reactEveryTime=function(){return"EveryTime"===this.triggerType},t.prototype.reactOnEntry=function(){return"OnEntry"===this.triggerType},t.prototype.reactOnExit=function(){return"OnExit"===this.triggerType},t.prototype.trackImpression=function(t){var e={reaction_id:this.id,variant_id:this.variantId,type:"impression"};this.permutive.track("Reaction",e,t),this._internals.log("impression: ",e)},t.prototype.trackConversion=function(t){var e={reaction_id:this.id,variant_id:this.variantId,type:"conversion"};this.permutive.track("Reaction",e,t),this._internals.log("conversion: ",e)},t}();e.PermutiveReaction=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventsCacheStore=void 0;var r=n(11),i=n(40),o=n(1),u=n(0),a=n(41),s=function(){function t(t,e,n,r,u,s,c){var f=this;this._internals=t,this.cryptoAlg=e,this.dbName=n,this.mainObjectStore=r,this.keyObjectStore=u,this.keyObjectKey=s,this.version=c,this.db=a.IndexedDB.initialise(this._internals,this.cryptoAlg,this.dbName,this.mainObjectStore,this.keyObjectStore,this.keyObjectKey,this.version)().then(o.getOrElse((function(t){return new i.LocalStorageDB(f._internals)})))}return t.prototype.put=function(t,e){var n=this;return r.tryCatch((function(){return n.db.then((function(n){return n.put(t,e)}))}),(function(t){return String(t)}))},t.prototype.get=function(t){var e=this;return r.tryCatch((function(){return e.db.then((function(e){return e.get(t)})).then(u.fromNullable)}),(function(t){return String(t)}))},t.prototype.delete=function(t){var e=this;return r.tryCatch((function(){return e.db.then((function(e){return e.delete(t)}))}),(function(t){return String(t)}))},t.prototype.deleteStore=function(){var t=this;return r.tryCatch((function(){return t.db.then((function(t){return t.deleteStore()}))}),(function(t){return String(t)}))},t.prototype.migrateIfRequired=function(){var t=this;return r.tryCatch((function(){return t.db.then((function(t){return t.migrateIfRequired()}))}),(function(t){return String(t)}))},t}();e.EventsCacheStore=s},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.LocalStorageDB=void 0;var r=n(2),i=function(){function e(t){this._internals=t}return e.prototype.put=function(e,n){return r.pipe(this._internals.getNamespacedStorageKey(String(n)),(function(t){return window.localStorage.setItem(t,JSON.stringify(e))}),(function(e){return t.resolve(n)}))},e.prototype.get=function(t){return r.pipe(this._internals.getNamespacedStorageKey(String(t)),(function(t){return JSON.parse(window.localStorage.getItem(t))}))},e.prototype.delete=function(e){return r.pipe(this._internals.getNamespacedStorageKey(String(e)),(function(e){return t.resolve(window.localStorage.removeItem(e))}))},e.prototype.deleteStore=function(){return t.resolve()},e.prototype.migrateIfRequired=function(){return t.resolve()},e}();e.LocalStorageDB=i}).call(this,n(3).Promise)},function(t,e,n){"use strict";(function(t){var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0}),e.IndexedDB=void 0;var o=n(42),u=n(11),a=n(1),s=n(2),c=n(17),f=n(13),l=n(8),d=function(){function e(t,e,n,r,i,o){this._internals=t,this.cryptoAlg=e,this.idb=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=o,this.MAX_CONSECUTIVE_PUTS=50,this.puts=1,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.cryptoKey=this.getOrGenerateKey()}return e.initialise=function(t,n,r,i,s,c,f){var l=("development"===t.config.environment?window.isSecureContext:"https:"===window.location.protocol)?a.tryCatch((function(){return o.openDB(r,f,{upgrade:function(t){t.createObjectStore(i),t.createObjectStore(s)}})}),(function(t){return String(t)})):a.left("Insecure context. Can't use crypto APIs");return a.fold((function(t){return u.left(t)}),(function(r){return u.tryCatch((function(){return r.then((function(r){return new e(t,n,r,i,s,c)}))}),(function(t){return String(t)}))}))(l)},e.prototype.put=function(e,n){var r=this;return this.cryptoKey.then((function(i){return s.pipe(JSON.stringify(e),(function(e){return new t((function(t,o){r.cryptoAlg.encrypt(i,e).then((function(e){return s.pipe(r._internals.getNamespacedStorageKey(String(n)),(function(i){return r.resetIfRequired(r.puts++).then((function(o){return r.idb.put(r.mainObjectStore,e,i).then((function(e){return t(n)}))}))}))}),(function(t){return o(t)}))}))}))}))},e.prototype.get=function(t){var e=this;return this.cryptoKey.then((function(n){return s.pipe(e._internals.getNamespacedStorageKey(String(t)),(function(t){return e.idb.get(e.mainObjectStore,t).then((function(t){return t?e.cryptoAlg.decrypt(n,t):null})).then(JSON.parse)}))}))},e.prototype.delete=function(t){var e=this;return s.pipe(this._internals.getNamespacedStorageKey(String(t)),(function(t){return e.idb.delete(e.mainObjectStore,t)}))},e.prototype.migrateIfRequired=function(){var e=this,n=s.pipe(this._internals.getExternalData(c.EVENTS_CACHE_KEY),(function(t){return t?u.right(JSON.parse(t)):u.left(null)})),r=u.tryCatch((function(){return e.idb.get("events","permutive-events-cache")}),(function(t){}));return t.all([n(),r()]).then((function(t){return t.filter(a.isRight).map((function(t){return t.right})).filter((function(t){return t}))})).then(f.flatten).then((function(t){return s.pipe(t,(function(t){return t.forEach((function(t){return e._internals.state.eventsCache.add(l.deserializeEvent(t),!1)}))}),(function(t){return e._internals.removeExternalData(c.EVENTS_CACHE_KEY)}))})).then((function(n){return-1!==i(e.idb.objectStoreNames).indexOf("events")?e.idb.delete("events","permutive-events-cache"):t.resolve()}))},e.prototype.deleteStore=function(){var e=this;return t.resolve(this.idb.close()).then((function(t){return o.deleteDB(e.idb.name)}))},e.prototype.getOrGenerateKey=function(){var t=this;return s.pipe(this._internals.getNamespacedStorageKey(this.keyObjectKey),(function(e){return t.idb.get(t.keyObjectStore,e).then((function(e){return e||t.storeGivenOrGeneratedKey()}))}))},e.prototype.storeGivenOrGeneratedKey=function(e){var n=this;return(e||this.cryptoAlg.generateKey(!1)).then((function(t){return s.pipe(n._internals.getNamespacedStorageKey(n.keyObjectKey),(function(e){return n.idb.put(n.keyObjectStore,t,e)}),(function(e){return t}))}),(function(e){return t.reject(e)}))},e.prototype.resetIfRequired=function(e){var n=this,r=this.idb.name,i=this.idb.version;return this.isSafari&&e%this.MAX_CONSECUTIVE_PUTS==0?this.deleteStore().then((function(t){return o.openDB(r,i,{upgrade:function(t){t.createObjectStore(n.mainObjectStore),t.createObjectStore(n.keyObjectStore)}})})).then((function(t){n.idb=t,n.storeGivenOrGeneratedKey(n.cryptoKey)})):t.resolve()},e}();e.IndexedDB=d}).call(this,n(3).Promise)},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.deleteDB=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.blocked,i=indexedDB.deleteDatabase(t);n&&i.addEventListener("blocked",(function(){return n()}));return(0,r.w)(i).then((function(){}))},e.openDB=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.blocked,o=n.upgrade,u=n.blocking,a=n.terminated,s=indexedDB.open(t,e),c=(0,r.w)(s);o&&s.addEventListener("upgradeneeded",(function(t){o((0,r.w)(s.result),t.oldVersion,t.newVersion,(0,r.w)(s.transaction))}));i&&s.addEventListener("blocked",(function(){return i()}));return c.then((function(t){a&&t.addEventListener("close",(function(){return a()})),u&&t.addEventListener("versionchange",(function(){return u()}))})).catch((function(){})),c},Object.defineProperty(e,"unwrap",{enumerable:!0,get:function(){return r.u}}),Object.defineProperty(e,"wrap",{enumerable:!0,get:function(){return r.w}});var r=n(43);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(){}function s(e,n){if(!n)return e&&e.then?e.then(a):t.resolve()}function c(t,e){var n=t();return n&&n.then?n.then(e):e(n)}function f(e,n,r){return r?n?n(e):e:(e&&e.then||(e=t.resolve(e)),n?e.then(n):e)}var l=["get","getKey","getAll","getAllKeys","count"],d=["put","add","delete","clear"],p=new Map;function h(e,n){if(r=e,(null!=(i=IDBDatabase)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](r):r instanceof i)&&!(n in e)&&"string"==typeof n){var r,i;if(p.get(n))return p.get(n);var o=n.replace(/FromIndex$/,""),u=n!==o,a=d.includes(o);if(o in(u?IDBIndex:IDBObjectStore).prototype&&(a||l.includes(o))){var h,v=(h=function(t){for(var e,n=this,r=n.transaction(t,a?"readwrite":"readonly"),i=r.store,l=arguments.length,d=new Array(l>1?l-1:0),p=1;p<l;p++)d[p-1]=arguments[p];return u&&(i=i.index(d.shift())),f((e=i)[o].apply(e,d),(function(t){return c((function(){if(a)return s(r.done)}),(function(){return t}))}))},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return t.resolve(h.apply(this,e))}catch(e){return t.reject(e)}});return p.set(n,v),v}}}(0,r.r)((function(t){return o(o({},t),{},{get:function(e,n,r){return h(e,n)||t.get(e,n,r)},has:function(e,n){return!!h(e,n)||t.has(e,n)}})}))}).call(this,n(3).Promise)},function(t,e,n){"use strict";(function(t){function n(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}Object.defineProperty(e,"__esModule",{value:!0}),e.r=function(t){l=t(l)},e.w=h,e.u=e.i=e.a=void 0;var r,i,o=function(t,e){return e.some((function(e){return n(t,e)}))};e.i=o;var u=new WeakMap,a=new WeakMap,s=new WeakMap,c=new WeakMap,f=new WeakMap;e.a=f;var l={get:function(t,e,r){if(n(t,IDBTransaction)){if("done"===e)return a.get(t);if("objectStoreNames"===e)return t.objectStoreNames||s.get(t);if("store"===e)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return h(t[e])},set:function(t,e,n){return t[e]=n,!0},has:function(t,e){return!(!n(t,IDBTransaction)||"done"!==e&&"store"!==e)||e in t}};function d(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(v(this),n),h(u.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return h(t.apply(v(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=t.call.apply(t,[v(this),e].concat(r));return s.set(o,e.sort?e.sort():[e]),h(o)}}function p(e){return"function"==typeof e?d(e):(n(e,IDBTransaction)&&function(e){if(!a.has(e)){var n=new t((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=function(){t(),r()},o=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));a.set(e,n)}}(e),o(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e)}function h(e){if(n(e,IDBRequest))return r=e,(i=new t((function(t,e){var n=function(){r.removeEventListener("success",i),r.removeEventListener("error",o)},i=function(){t(h(r.result)),n()},o=function(){e(r.error),n()};r.addEventListener("success",i),r.addEventListener("error",o)}))).then((function(t){n(t,IDBCursor)&&u.set(t,r)})).catch((function(){})),f.set(i,r),i;var r,i;if(c.has(e))return c.get(e);var o=p(e);return o!==e&&(c.set(e,o),f.set(o,e)),o}var v=function(t){return f.get(t)};e.u=v}).call(this,n(3).Promise)},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u};Object.defineProperty(e,"__esModule",{value:!0}),e.AESCrypto=void 0;var i=function(){function t(){this.crypto=window.crypto||window.msCrypto,this.ALG_NAME="AES-GCM"}return t.prototype.generateKey=function(t){return void 0===t&&(t=!1),this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},t,["encrypt","decrypt"])},t.prototype.encrypt=function(t,e){var n=r(this._encrypt(t,this.str2bytes(e)),2),i=n[0],o=n[1];return i.then((function(t){var e=new Uint8Array(16+t.byteLength);return e.set(o,0),e.set(new Uint8Array(Uint32Array.of(t.byteLength).buffer),12),e.set(new Uint8Array(t),16),e.buffer}))},t.prototype.decrypt=function(t,e){var n=new Uint8Array(e,0,12),r=new Uint32Array(e,12,1)[0],i=e.slice(16,16+r);return this._decrypt(t,n,i).then(this.bytes2str)},t.prototype._encrypt=function(t,e){var n=this.crypto.getRandomValues(new Uint8Array(12));return[this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:n},t,e),n]},t.prototype._decrypt=function(t,e,n){return this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:e},t,n)},t.prototype.str2bytes=function(t){return(new TextEncoder).encode(t).buffer},t.prototype.bytes2str=function(t){return(new TextDecoder).decode(t)},t}();e.AESCrypto=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveTaskQueue=void 0;var r=function(){function t(t){var e=this;this._internals=t,this.queue=[],this.nextNotify=null,t.messages.on("permutive:taskQueue:update",(function(){e.execute()}))}return t.prototype.add=function(t){this.queue.push(t),this.notify()},t.prototype.notify=function(){var t=this,e=function(){t._internals.messages.emit("permutive:taskQueue:update")},n=(new Date).getTime();null===this.nextNotify||this.nextNotify<n-50?(this.nextNotify=n,e()):this.nextNotify<=n&&(this.nextNotify=n+50,window.setTimeout(e,50))},t.prototype.execute=function(){var t=this;if(0!==this.queue.length){for(var e=!1,n=!1,r=0,i=0;i<this.queue.length;i++){var o=this.queue[i];if(o.complete)r+=1;else if(o.started)n=!0,e=e||o.blocks();else{if(o.waits()&&n)break;e||(n=!0,e=e||o.blocks(),o.execute((function(){t.notify()})))}}this.queue.splice(0,r)}},t.prototype.size=function(){return this.queue.length},t}();e.PermutiveTaskQueue=r},function(t,e,n){"use strict";(function(t){var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveInternals=void 0;var o=n(47),u=n(48),a=n(49),s=n(19),c=n(50),f=n(51),l=n(52),d=n(53),p=function(){function e(e,n,r,i,p,h,v,m){void 0===r&&(r=[]),void 0===i&&(i={}),void 0===p&&(p=new f.EventHandler),void 0===h&&(h=new a.PermutivePromises),void 0===v&&(v=new l.Events),void 0===m&&(m=new s.GlobalEnricher),this.config=e,this.network=n,this.blockers=r,this.addons=i,this.eventHandler=p,this.promises=h,this.messages=v,this.enrichers=m,this.isReady=!1,this.isRealtime=!1,this.isIdentityReady=!1,this.listenForBlockers=!0,this.sessionManager=new o.SessionManager(this),this.eventsBatch=new d.PermutiveEventsBatch(this),this.api=new u.PermutiveApi(this),this.graphql=new c.GraphQLQuery(this),this.models={getModels:function(){return t.resolve({})}}}return e.prototype.makeSafe=function(t){var e=this;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{return t.apply(void 0,i(n))}catch(t){e.network.error(t,e.state.userId)}}},e.prototype.utcNow=function(){var t=new Date;return new Date(t.toUTCString())},e.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.config.loggingEnabled&&window.console&&window.console.log&&(t.splice(0,0,"[Permutive]"),console.log.apply(console,i(t)))},e.prototype.setAsReady=function(){this.isReady=!0,this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{sdk_version:"v9.11.6"}),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}})),this.messages.emit("permutive:ready")},e.prototype.setAsRealtime=function(){this.isRealtime=!0,this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{})},e.prototype.setIdentityReady=function(){this.isIdentityReady=!0},e.prototype.addBlocker=function(t){var e=this;this.blockers.push(t),this.log("<blockers> added blocker "+t),this.messages.on(t,(function(){if(e.listenForBlockers){var n=e.blockers.indexOf(t);n>=0&&(e.blockers.splice(n,1),e.log("<blockers> removed blocker "+t)),0===e.blockers.length&&(e.listenForBlockers=!1,e.messages.emit("permutive:blockers:empty"),e.log("<blockers> complete"))}}))},e.prototype.getNamespacedStorageKey=function(t){return""+this.config.stateNamespace+t},e.prototype.setCookie=function(t,e,n){if(void 0===n&&(n=!1),!(e&&t&&this.config.cookieExpiry&&this.config.cookieDomain))return!1;var r=this.getNamespacedStorageKey(t);document.cookie=[encodeURIComponent(r),"=",encodeURIComponent(e),"; expires=",this.config.cookieExpiry,"; domain=",this.config.cookieDomain,"; path=/",n?"; samesite=none; secure":""].join("")},e.prototype.getCookie=function(t,e){void 0===e&&(e=!1);var n=e?t:this.getNamespacedStorageKey(t),r=new RegExp(encodeURIComponent(n)+"=([^;]+)").exec(document.cookie);return null!==r?decodeURIComponent(r[1]):null},e.prototype.deleteCookie=function(t){if(!t||!this.config.cookieDomain)return!1;var e=this.getNamespacedStorageKey(t);return document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+this.config.cookieDomain+"; path=/",!0},e.prototype.getExternalData=function(t){var e=this.getNamespacedStorageKey(t);return localStorage.getItem(e)},e.prototype.setExternalData=function(t,e){var n=this.getNamespacedStorageKey(t);this.makeSafe((function(){localStorage.setItem(n,e)}))()},e.prototype.removeExternalData=function(t){var e=this.getNamespacedStorageKey(t);localStorage.removeItem(e)},e.prototype.arraysEqual=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0},e}();e.PermutiveInternals=p}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionManager=void 0;var r=n(4),i=function(){function t(t,e){this._internals=t,(e=e||{}).timeout_seconds=e.timeout_seconds||1800,e.session_data_key=e.session_data_key||"permutive-session",this.options=e,this.session_id=null,this.initialize()}return t.prototype.getSessionId=function(){return this.session_id},t.prototype.newSession=function(t){return{session_id:r.uuidv4(),last_updated:t}},t.prototype.initialize=function(){var t=new Date,e=this._internals.getCookie(this.options.session_data_key),n=this.decodeSessionData(e);if(null===n)n=this.newSession(t);else{var r=this.options.timeout_seconds;t>new Date(n.last_updated.getTime()+1e3*r)?n=this.newSession(t):n.last_updated=t}this.persistSessionData(n),this.session_id=n.session_id},t.prototype.decodeSessionData=function(t){var e=null;try{e=JSON.parse(t)}catch(t){return null}return null!==e&&"object"==typeof e&&e.hasOwnProperty("session_id")&&e.hasOwnProperty("last_updated")&&(e.last_updated=new Date(e.last_updated),!isNaN(e.last_updated.getTime()))?e:null},t.prototype.persistSessionData=function(t){t.last_updated=t.last_updated.toISOString(),this._internals.setCookie(this.options.session_data_key,JSON.stringify(t))},t}();e.SessionManager=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveApi=void 0;var r={success:function(t){},error:function(t,e){}},i=function(){function t(t){this._internals=t}return t.prototype.identify=function(t,e){var n=this;if(void 0===e&&(e=r),t.forEach((function(t){return n._internals.identities.addAlias(t.id,t.tag)})),this._internals.isIdentityReady){var i=this._internals.identities.currentAliases;this.sendIdentify(this._internals.state.userId,i,e).then((function(t){return n._internals.identities.storeAliases(i)}))}},t.prototype.graphql=function(t,e){return void 0===e&&(e=r),this._internals.network.req({url:this._internals.config.apiProtocol+"://"+this._internals.config.apiHost+"/graphql",method:"POST",success:e.success,error:e.error,data:{query:t},contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)},t.prototype.sendIdentify=function(t,e,n){return void 0===n&&(n=r),this._internals.network.req({url:this._internals.network.getEndpointUrl("/identify"),method:"POST",data:{user_id:t,aliases:this._internals.identities.convertAliases(e)},success:n.success,error:n.error,contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)},t.prototype.setUserProperties=function(t,e){return void 0===e&&(e=r),this._internals.network.req({url:this._internals.network.getEndpointUrl("/users/"+this._internals.state.userId+"/properties"),method:"POST",data:{properties:t},success:e.success,error:e.error,contentType:"text/plain"},!1)},t.prototype.metrics=function(t,e){return void 0===e&&(e=r),this._internals.network.req({url:this._internals.network.getEndpointUrl("/internal/metrics"),method:"POST",data:t,contentType:"text/plain",dataType:"text",success:e.success,error:e.error},!1)},t.prototype.track=function(t,e,n){return this._internals.network.req({url:this._internals.network.getEndpointUrl((Array.isArray(t)?"/batch":"")+"/events")+"?enrich="+!!e.includeResponseBody,method:"POST",data:t,success:e.success,error:e.error,contentType:"text/plain"},n)},t.prototype.events=function(t,e){return void 0===e&&(e=r),this._internals.network.req({url:this._internals.network.getEndpointUrl("/events")+"?user_id="+t+(e.from?"&from="+e.from.toISOString():""),method:"GET",success:e.success,error:e.error,contentType:"text/plain"},!1)},t.prototype.tpdUsage=function(t,e){return void 0===e&&(e=r),this._internals.network.req({url:this._internals.network.getEndpointUrl("/tpd/usage"),method:"POST",data:t,success:e.success,error:e.error,contentType:"text/plain"},!1)},t.prototype.reset=function(){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/reset"),method:"POST",xhrFields:{withCredentials:!0},contentType:"text/plain"},!1)},t.prototype.segmentSync=function(t,e){return this._internals.network.ajax({url:"https://"+this._internals.config.segmentSyncApiHost+"/sync/"+t,type:"POST",data:"value="+encodeURIComponent(e),contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:!0}})},t.prototype.models=function(t){var e="binary"===t?"bin":"json";return this._internals.network.ajax({url:"https://"+this._internals.config.cdnBaseUrl+"/models/"+this._internals.config.projectId+"-models."+e,dataType:t})},t}();e.PermutiveApi=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermutivePromises=void 0;var r=n(4),i=function(){function t(){this.promises={}}return t.prototype.addPromise=function(t,e,n,r){var i=this;t in this.promises||(this.promises[t]={}),this.promises[t][e]=r,window.setTimeout((function(){i.resolvePromise(t,e)}),n)},t.prototype.createPromise=function(t,e,n){this.addPromise(t,e,n,r.deferredPromise())},t.prototype.getPromise=function(t,e){return r.lens(this.promises,t,e)},t.prototype.resolvePromise=function(t,e){var n=this.getPromise(t,e);return void 0!==n?(n.resolve(),n):void 0},t.prototype.getPromisesByCategory=function(t){var e=r.lens(this.promises,t)||{};return Object.keys(e).map((function(t){return e[t]}))},t}();e.PermutivePromises=i},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLQuery=void 0;var r=n(4),i=function(){function e(t){this._internals=t,this.queries={},this.promises={}}return e.prototype.register=function(t){var e=r.deferredPromise();return this.queries[t.resource]=t.query(),this.promises[t.resource]=e,e.promise},e.prototype.run=function(){var e=this;if(0===Object.keys(this.queries).length)return t.resolve();var n=r.deferredPromise();return this._internals.api.graphql(this.toQueryString(this.queries),{success:function(t){Object.keys(e.promises).forEach((function(n){var r=t.data[n];r?e.promises[n].resolve(r):e.promises[n].reject("Could not find a graphql response for resource "+n)})),n.resolve()},error:function(t){console.error(t),Object.keys(e.promises).forEach((function(t){return e.promises[t].reject()})),n.reject()}}),n.promise},e.prototype.toQueryString=function(t){return"{ "+Object.keys(t).map((function(e){return t[e]})).join(" ")+" }"},e}();e.GraphQLQuery=i}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventHandler=void 0;var r=function(){function t(){this.events=[],this.listeners=[]}return t.prototype.newEvent=function(t,e){var n=this;this.events.push([t,e]),this.listeners.forEach((function(r){n.handle(t,e,r)}))},t.prototype.addListener=function(t){var e=this;this.listeners.push(t);var n={replay:function(){return e.replay(t),n},remove:function(){return e.remove(t),n}};return n},t.prototype.handle=function(t,e,n){var r="string"==typeof n.name&&t.name===n.name,i=n.name.test&&n.name.test(t.name),o=r||i;if(o)try{n.callback(t,e)}catch(t){window.console&&window.console.error&&window.console.error("callback error: ",t)}o&&n.once&&this.remove(n)},t.prototype.replay=function(t){for(var e=-1!==this.listeners.indexOf(t),n=0;n<this.events.length&&e;n++)this.handle(this.events[n][0],this.events[n][1],t),e=-1!==this.listeners.indexOf(t)},t.prototype.remove=function(t){var e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)},t}();e.EventHandler=r},function(t,e,n){"use strict";function r(t){var e={},n=[];(t=t||this).on=function(n,r,i){return(e[n]=e[n]||[]).push([r,i]),t},t.off=function(r,i){r||(e={});for(var o=e[r]||n,u=o.length=i?o.length:0;u--;)i==o[u][0]&&o.splice(u,1);return t},t.once=function(e,r){var i=n.slice.call(arguments,2),o=function(){r(i),t.off(e,o)};return t.on(e,o),t},t.emit=function(r){for(var i,o=e[r]||n,u=o.length>0?o.slice(0,o.length):o,a=0;i=u[a++];)i[0].apply(i[1],n.slice.call(arguments,1));return t}}n.r(e),n.d(e,"Events",(function(){return r}))},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveEventsBatch=void 0;var o=n(8),u=n(4),a=function(){function t(t){var e=this;this._internals=t,this.timeoutDuration=500,this.maxWaitTime=5e3,this.requests=[],setInterval((function(){e.requests.length>0&&e.flush()}),this.maxWaitTime),u.onPageUnload((function(){e.requests.length>0&&e.flush(!0)}))}return t.prototype.add=function(t,e,n){this.resetTimeout(),this.requests.push([t,e,n])},t.prototype.flush=function(t){var e=this;void 0===t&&(t=!1);var n=i(this.requests);t||this.trackMetrics(n),this._internals.api.track(n.map((function(t){return t[0]})),{},t).then((function(t){return e.isBatchResponse(t)?e.handleBatchResponse(t,n):null}),(function(t){return e._internals.network.error(t)})).catch((function(t){return e._internals.network.error(t)})),this.requests=[]},t.prototype.handleBatchResponse=function(t,e){var n=this;t.map((function(t){return t.body})).forEach((function(t,r){var i=e.map((function(t){return t[0]}))[r],u=e[r][1],a=e[r][2];o.isEventTrackError(t)?n.handleTrackError(t,i,u.error):n.handleTrackResponse(t,i,u.success,a)}))},t.prototype.handleTrackResponse=function(t,e,n,r){var i=o.deserializeMinimalEvent(t,e);n(i),"never"!==r&&(this._internals.state.eventsCache.add(i),this._internals.eventHandler.newEvent(o.serializeEvent(i),null))},t.prototype.handleTrackError=function(t,e,n){var r={name:e.name,session_id:e.session_id,view_id:e.view_id,properties:e.properties,id:null,time:(new Date).toISOString()};n(t.error.message),this._internals.eventHandler.newEvent(r,t),console.error(t)},t.prototype.setTimeout=function(t){var e=this;return window.setTimeout((function(){return e.flush()}),t)},t.prototype.resetTimeout=function(){clearTimeout(this.timeout),this.timeout=this.setTimeout(this.timeoutDuration)},t.prototype.trackMetrics=function(t){this._internals.metrics.track({name:"sdk_events_batch_size_total",value:t.length,labels:{}}),this._internals.metrics.track({name:"sdk_events_batch_size_bytes",value:2*JSON.stringify(t.map((function(t){return t[0]}))).length,labels:{}})},t.prototype.isBatchResponse=function(t){return!!t},t}();e.PermutiveEventsBatch=a},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveMetrics=e.PermutiveMetricsNoOp=void 0;var o=n(4),u=function(){function t(){}return t.prototype.track=function(t){},t.prototype.trackTimeSinceInit=function(t,e){},t.prototype.startTimer=function(t,e){return""},t.prototype.stopTimer=function(t,e){},t}();e.PermutiveMetricsNoOp=u;var a=function(){function t(t,e,n){var r=this;this.sdkInitTimestamp=t,this._internals=e,this.permutive=n,this.sendFrequencyInSeconds=5,this.pendingMetrics=[],this.pendingTimers={},this.permutive.ready((function(){window.setInterval(r.processPending.bind(r),1e3*r.sendFrequencyInSeconds),o.onPageUnload((function(){r.processPending.bind(r)}))})),this.track({name:"sdk_initialisation_start_time_seconds",value:t/1e3,labels:{}})}return t.prototype.track=function(t){this.pendingMetrics.push(t)},t.prototype.trackTimeSinceInit=function(t,e){var n=performance.now();this.track({name:t,value:(n-this.sdkInitTimestamp)/1e3,labels:e})},t.prototype.startTimer=function(t,e){var n=performance.now(),r=this.generateRandomKey(t);return this.pendingTimers[r]={startTime:n,labels:e},r},t.prototype.stopTimer=function(t,e){var n=this.pendingTimers[e];if(n){var r=performance.now();this.track({name:t,value:(r-n.startTime)/1e3,labels:n.labels}),delete this.pendingTimers[e]}},t.prototype.processPending=function(){this.pendingMetrics.length>0&&(this._internals.api.metrics({context:{environment:"web",events_count:this._internals.state.eventsCache.all().length,segments_count:Object.keys(this._internals.queryManager.queryStateMap).length},items:this.pendingMetrics}),this.pendingMetrics=[])},t.prototype.generateRandomKey=function(t){return t+"-"+i(Array(24)).map((function(){return Math.random().toString(36)[2]})).join("")},t}();e.PermutiveMetrics=a},function(t,e,n){"use strict";(function(t){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u};Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveThirdParty=e.providerToIdMap=void 0;var o=n(4),u=n(56);e.providerToIdMap={permutive:"1",eyeota:"2",skimlinks:"4",comscore:"5",eyeota_bombora:"6",eyeota_aimmatic:"7",eyeota_alc:"8",eyeota_amberdata:"9",eyeota_caci:"10",eyeota_corelogic:"11",eyeota_dlg:"12",eyeota_dataxpand:"13",eyeota_dunbradstreet:"14",eyeota_experian:"15",eyeota_gbgtransactis:"16",eyeota_gfk:"17",eyeota_rdaresearch:"18",eyeota_kantarmedia:"19",eyeota_mastercard:"20",eyeota_meritdirect:"21",eyeota_netsprint:"22",eyeota_nri:"23",eyeota_onaudience:"24",eyeota_pacificdatapartners:"25",eyeota_plungedigital:"26",eyeota_roymorgan:"27",eyeota_schober:"28",eyeota_sharethis:"30",eyeota_skimlinks:"31",eyeota_specialists:"32",eyeota_statsocial:"33",eyeota_stirista:"34",eyeota_yougov:"36"};var a=function(){function n(t,e,n){this._internals=t,this.permutive=e,this.network=n;var r=this._internals.state.getPermutiveData("third-party-data");this.userSegments=this.isValidState(r)?r:{},this.lastCheckedSession=this._internals.state.getPermutiveData("third-party-data-session-id")||""}return n.prototype.segments=function(){var e=this;if(this.segmentsPromise)return this.segmentsPromise;var n=this._internals.sessionManager.getSessionId();if(this.lastCheckedSession===n)return t.resolve(this.userSegments);var a=o.deferredPromise();this.lastCheckedSession=n;var s=this._internals.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{}),c=r(r({},this._internals.identities.getIdentities(!0)),this._internals.identities.currentAliases);if(Object.keys(c).length>0){var f=new u.GraphQLTPD(this._internals.state.userId||o.uuidv4(),this._internals.identities.convertAliases(c));this._internals.graphql.register(f).then((function(t){var n=e.graphQLTPDResponseToSegmentMap(t);e.updateCache(n),a.resolve(n)})).catch((function(t){e.network.error("Third Party Data segments retrieval failed with reason: "+t,e._internals.state.userId),a.resolve({})}))}else a.resolve({});var l=this._internals.promises.getPromisesByCategory("tpd"),d=t.all(l.map((function(t){return t.promise}))).then((function(t){return a.promise})).then((function(t){return e.userSegments}));return d.then((function(t){e._internals.state.setPermutiveData("third-party-data-session-id",n),e._internals.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",s);var r=e._internals.state.getPermutiveData("third-party-data");r&&o.nonPrimitiveEq(r,t)||(e._internals.state.setPermutiveData("third-party-data",e.userSegments),Object.entries(t).forEach((function(t){var n=i(t,2),u=n[0],a=n[1];r&&o.nonPrimitiveEq(r[u],a)||e.fireSegments(u,Object.keys(a))})))})),this.segmentsPromise=d,this.segmentsPromise},n.prototype.addSegments=function(t,e){var n;this.updateCache(((n={})[t]=this.listToSegmentMap(e),n))},n.prototype.getActivationMetadata=function(){var t=this._internals.queryManager.getTpdUsage(),n={},i=function(i){if(t.hasOwnProperty(i)){var o=[],u=r({},t[i]);Object.keys(u).forEach((function(t){u[t].forEach((function(n){o.push([i,e.providerToIdMap[t],n].join("-"))}))})),n[i]=o}};for(var o in t)i(o);return n},n.prototype.updateCache=function(t){this.userSegments=o.mergeObjects(this.userSegments,t)},n.prototype.fireSegments=function(t,e){this.permutive.track("ThirdPartySegments",{data_provider:t,segments:e},{isAnalyticsOnly:!0})},n.prototype.reportUsage=function(){var t=this._internals.queryManager.getTpdUsage(),e=o.hash(JSON.stringify(t));if(this._internals.state.getPermutiveData("third-party-data-usage")!==e&&Object.keys(t).length>0){this._internals.state.setPermutiveData("third-party-data-usage",e);var n={user_id:this._internals.state.userId,time:new Date,tpd_segments:t};this._internals.api.tpdUsage(n)}},n.prototype.graphQLTPDResponseToSegmentMap=function(t){var e=this;return t.identity.tpd.reduce((function(t,n){var i;return r(r({},t),((i={})[n.name]=e.listToSegmentMap(n.segments),i))}),{})},n.prototype.listToSegmentMap=function(t){return t.reduce((function(t,e){return t[e]=!0,t}),{})},n.prototype.isValidState=function(t){return t&&void 0===t.expiry_time},n}();e.PermutiveThirdParty=a}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLTPD=void 0;var r=function(t,e){var n=this;this.userId=t,this.aliases=e,this.resource="userTPD",this.query=function(){var t=n.aliases.map((function(t){return'{id: "'+t.id+'", tag: "'+t.tag+'", priority: '+t.priority+"}"})).join(",");return'\n      userTPD: user(user_id: "'+n.userId+'") {\n        identity(aliases: ['+t+"]) {\n          tpd {\n            name\n            segments\n          }\n        }\n      }\n    "}};e.GraphQLTPD=r},function(t,e,n){"use strict";(function(t){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u};Object.defineProperty(e,"__esModule",{value:!0}),e.PermutiveMethods=void 0;var o=n(4),u=n(12),a=n(58),s=n(8),c=n(2),f=function(){function e(t,e,n){this._internals=t,this.network=e,this.context=n,this.initialisedAddons=[]}return e.prototype.identify=function(t){var e=this;this._internals.log("<call> identify",t);var n=u.PermutiveIdentities.getAliasesFromIdentifyArg(t),r=o.deferredPromise(),i=n.map((function(t){return t.id})).concat(o.objectEntries(this._internals.identities.currentAliases).map((function(t){return t[1]})));if("string"==typeof t&&u.hasBrokenIdentity("e488cdb0-e7cb-4d91-9648-60d437d8e491",i,window.location.hostname,this._internals.state.userId))return r.resolve(),r.promise;return this._internals.state.taskQueue.add(new a.Task((function(t){e._internals.log("<task> identify ",n);var i=e._internals.state.userId,o={success:function(o){var u=o.user_id;if(u!==i){var a={error:function(){e.network.error("couldn't retrieve events for user "+u,u),t(),r.resolve()},from:new Date(0)};e._internals.state.reset().then((function(){return c.pipe(e._internals.state.setUserId(u),(function(t){return e._internals.state.eventsCache.reset()})).then((function(t){return e._internals.state.eventsCache.refresh(a)})).then((function(t){var n=e._internals.state.eventsCache.processRefreshEvents(t,{write:!0});return e._internals.queryManager.updateSegmentResults(n),e._internals.queryManager.initWorker(n)})).then((function(){t(),r.resolve()}))}))}else e._internals.log("<done> identify ",n),t(),r.resolve()},error:function(){e.network.error("Couldn't set identity for user "+i,i),t(),r.resolve()}};e._internals.api.identify(n,o)}),{wait_prev:!0,block_next:!0})),r.promise},e.prototype.on=function(t,e){return this._internals.eventHandler.addListener({name:t,callback:e,once:!1})},e.prototype.once=function(t,e){return this._internals.eventHandler.addListener({name:t,callback:e,once:!0})},e.prototype.track=function(){for(var e=this,n=[],u=0;u<arguments.length;u++)n[u]=arguments[u];var c=i([n[0],n[1]||{},n[2]||{}],3),f=c[0],d=c[1],p=c[2];this._internals.log("<call> track",f);var h=o.deferredPromise();if(!this._internals.api)return this.network.error("The API hasn't been loaded."),h.reject(),h.promise;var v=!!p.isAnalyticsOnly,m=this._internals.sessionManager.getSessionId(),g=this._internals.state.viewId,_={success:p.success||function(t){},error:p.error||function(t,e){}},y=function(n){e._internals.log("<task> track",f);var u,a=v?null:e._internals.metrics.startTimer("sdk_events_api_roundtrip_seconds",{}),c=v?null:e._internals.metrics.startTimer("sdk_events_overall_processing_seconds",{}),y=i(e._internals.enrichers.enrich([d,!0]),2),b=y[0],k=y[1],w=r(r({},b),{client:e._internals.state.getClient()}),S=l(p,k),E={user_id:e._internals.state.userId,name:f,segments:e._internals.queryManager.userSegments,properties:w,session_id:m,view_id:g},O={name:f,properties:w,session_id:m,view_id:g,time:new Date},I=function(t){var n=e._internals.metrics.startTimer("sdk_events_querylanguage_seconds",{});return e._internals.queryManager.update([t]).then((function(){e._internals.metrics.stopTimer("sdk_events_querylanguage_seconds",n),e._internals.metrics.stopTimer("sdk_events_overall_processing_seconds",c)}))},P=function(n){e._internals.log("Tracking failed with reason",n);var r={name:E.name,session_id:E.session_id,view_id:E.view_id,properties:E.properties,id:null,time:new Date};return t.resolve({event:r,error:n})},M=function(e){var n=s.isFullPermutiveEventJson(e)?s.deserializeEvent(r(r({},e),{session_id:E.session_id,view_id:E.view_id})):s.deserializeMinimalEvent(e,E);return t.resolve({event:n,error:null})},T=function(e){return t.resolve(e.error?_.error(e.error.error.message):_.success(e.event))},x=function(n){return n.error||e._internals.state.eventsCache.add(n.event),t.resolve(n)},j=function(n){return e._internals.eventHandler.newEvent(s.serializeEvent(n.event),n.error),t.resolve(n.event)};switch(S){case"immediate":u=o.forP((function(n){var r=i(n,2),o=r[0],u=r[1];return t.all([I(o),e._internals.eventsBatch.add(u,_,S),t.resolve(o)])}),(function(e){var n=i(e,3),r=(n[0],n[1],n[2]);return t.resolve(r)}));break;case"onResponse":u=o.forP((function(t){var n=i(t,2),r=(n[0],n[1]);return e._internals.api.track(r,{includeResponseBody:!0},!1)}),(function(t){return function(t){return e._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",a),s.isEventTrackError(t)?P(t):M(t)}(t)}),(function(e){return t.all([T(e),x(e),I(e.event),j(e)])}),(function(e){var n=i(e,4),r=(n[0],n[1],n[2],n[3]);return t.resolve(r)}));break;case"deferred":u=o.forP((function(n){var r=i(n,2),o=r[0],u=r[1];return t.all([e._internals.api.track(u,{includeResponseBody:!1},!0),t.resolve(o)])}),(function(t){var e=i(t,2),n=(e[0],e[1]);return j({event:n,error:null})}));break;case"never":u=function(n){var r=i(n,2),o=r[0],u=r[1];return e._internals.eventsBatch.add(u,_,S),t.resolve(o)}}u([O,E]).then((function(r){return h.resolve(r),e._internals.log("<done> track",r.name),n(),t.resolve(r)})).catch((function(t){e._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",a),_.error(t),e.network.error(t,e._internals.state.userId)}))};return this._internals.state.taskQueue.add(new a.Task(y)),h.promise},e.prototype.trigger=function(t,e,n){var r=this,i=o.deferredPromise();this._internals.log("<call> trigger",t),this._internals.triggerListeners=this._internals.triggerListeners||[];return this._internals.state.taskQueue.add(new a.Task((function(e){r._internals.log("<task> trigger",t);var o=r._internals.messages.on("permutive:query:changed",(function(e){e.queryCode===t&&(n(e.result),i.resolve(e.result))}));r._internals.triggerListeners.push(o),r._internals.log("<done> trigger",t),e()}))),i.promise},e.prototype.query=function(t,e){var n=this,r=o.deferredPromise();this._internals.log("<call> query",t);return this._internals.state.taskQueue.add(new a.Task((function(i){n._internals.log("<task> query",t),n._internals.queryManager.handleResult(t,(function(t){e(t),r.resolve(t)})),n._internals.log("<done> query",t),i()}))),r.promise},e.prototype.segment=function(t,e){var n=this,r=o.deferredPromise();this._internals.log("<call> segment",t);return this._internals.state.taskQueue.add(new a.Task((function(i){n._internals.log("<task> segment",t),n._internals.queryManager.handleResult(t,(function(n){if("boolean"!=typeof n.result)throw new Error("Segment "+t+" is missing boolean result property");e(n.result),r.resolve(n.result)})),n._internals.log("<done> segment",t),i()}))),r.promise},e.prototype.segments=function(t,e){var n=this;void 0===e&&(e="all");var r=o.deferredPromise();this._internals.log("<call> segments");return this._internals.state.taskQueue.add(new a.Task((function(i){n._internals.log("<task> segments ("+e+")");var o=function(o){t(o),r.resolve(o),n._internals.log("<done> segments ("+e+")"),i()};"dfp"===e?void 0!==n._internals.addons.dfp&&n._internals.addons.dfp.isReady?o(n._internals.addons.dfp.liveSegments):n._internals.messages.once("permutive:dfp:ready",(function(){o(n._internals.addons.dfp.liveSegments)})):o(n._internals.queryManager.userSegments)}))),r.promise},e.prototype.reset=function(){var e=this;return t.all([this._internals.state.reset(),this._internals.api.reset()]).then((function(t){var n=i(t,2),r=(n[0],n[1]);e._internals.state.setUserId(r.id),e._internals.state.eventsCache.reset(),e._internals.messages.emit("permutive:reset")}))},e.prototype.addon=function(e,i){var o=this;if(-1===this.initialisedAddons.indexOf(e)){this.initialisedAddons.push(e);var u=r(r({},i),{_internals:this._internals,permutive:this,network:this.network,context:this.context});switch(e){case"web":t.resolve().then((function(){return n(20)})).then((function(t){return o._internals.addons.web=new t.WebAddon(u)}));break;case"publishers":0;break;case"overlays":t.resolve().then((function(){return n(21)})).then((function(t){return o._internals.addons.overlays=new t.OverlaysAddon(u)}));break;case"scriptrunner":t.resolve().then((function(){return n(22)})).then((function(t){return o._internals.addons.scriptrunner=new t.ScriptRunnerAddon(u)}));break;case"dfp":case"smart":case"nativo":case"freewheel":case"gigya":case"facebook_pixel":case"facebook_pixel_v2":case"eyeota_pixel":case"pubmatic":case"tradedesk":case"dbm":case"rubicon":case"rubicon_ssp":case"aol":case"lotame":case"tracking_pixel":case"twitter_pixel":case"pinterest_pixel":case"local_storage":case"appnexus":case"appnexus_adserver":case"prebid":0}}else"web"===e&&!0!==i.auto_init&&this._internals.addons[e].reset(i)},e.prototype.ready=function(t,e){void 0===e&&(e="initialised");var n=o.deferredPromise(),r=function(){t(),n.resolve()};switch(e){case"initialised":this._internals.isReady?r():this._internals.messages.on("permutive:ready",r);break;case"realtime":this._internals.isRealtime?r():this._internals.messages.once("permutive:ready",r)}return n.promise},e}();function l(t,e){return t.useBeacon?"deferred":t.isAnalyticsOnly?"never":e?"immediate":"onResponse"}e.PermutiveMethods=f}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Task=void 0;var r=function(){function t(t,e){void 0===e&&(e={}),this.wait_prev=e.wait_prev||!1,this.block_next=e.block_next||!1,this.description=e.description||"",this.started=!1,this.complete=!1,this.task=t}return t.prototype.waits=function(){return this.wait_prev},t.prototype.blocks=function(){return this.block_next},t.prototype.execute=function(t){var e=this;this.started=!0,this.task((function(){e.complete=!0,t()}))},t}();e.Task=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLIdentify=void 0;var r=n(12),i=function(t,e){var n=this;this.userId=t,this.aliases=e,this.resource="userIdentify",this.query=function(){var t=n.aliases.map((function(t){return'{id: "'+t.id+'", tag: "'+t.tag+'", priority: '+t.priority+"}"})).join(",");return r.hasBrokenIdentity("e488cdb0-e7cb-4d91-9648-60d437d8e491",n.aliases.map((function(t){return t.id})),window.location.hostname,n.userId)?"":'\n      userIdentify: user(user_id: "'+n.userId+'") {\n        identity(aliases: ['+t+"]) {\n          identify {\n            id\n          }\n        }\n      }\n    "}};e.GraphQLIdentify=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLEvents=void 0;var r=function(t,e){var n=this;this.userId=t,this.from=e,this.resource="userEvents",this.query=function(){return'\n      userEvents: user(user_id: "'+n.userId+'") {\n        events(from: "'+n.from.toISOString()+'") {\n          id\n          name\n          time\n          session_id\n          view_id\n          properties\n        }\n      }\n    '}};e.GraphQLEvents=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.make=e.PERMUTIVE_CONFIG=void 0;var r,i=n(4);e.PERMUTIVE_CONFIG={default:{environment:"default",projectId:"",apiHost:"api.permutive.com",apiKey:"",cdnBaseUrl:"cdn.permutive.com",apiVersion:"v2.0",apiProtocol:"https",loggingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+function(t){var e=t.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=t.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=t.match(/localhost/);if(n&&n.length>0){var i=t.split(".").reverse();return i.length>=3&&i[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?i[2]+"."+i[1]+"."+i[0]:i[1]+"."+i[0]}return e&&e.length>0?e[0]:r&&r.length>0?"localhost":""}(window.location.hostname),cookieName:"permutive-id",cookieExpiry:(r=new Date,r.setFullYear(r.getFullYear()+3),r.toUTCString()),permutiveDataKey:"permutive-data",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:10,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"e488cdb0-e7cb-4d91-9648-60d437d8e491.partner.permutive.app"},production:{},development:{apiProtocol:"http",loggingEnabled:!0,sendClientErrors:!1}},e.make=function(t){return i.mergeObjects(e.PERMUTIVE_CONFIG.default,e.PERMUTIVE_CONFIG[t.environment]||{},t)}},function(t,e,n){"use strict";(function(t){var r=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.QueryManager=void 0;var i=n(4),o=n(63);function u(t){return"SegmentEntry"===t.name}var a=function(){function e(t,e,n){var r=this;this._internals=t,this.permutive=e,this.network=n,this.initialised=!1,this.stateChangeQueue=[],this.CACHED_SEGMENTS_STORAGE_KEY="_psegs",this.queryMetadata={39204:["0c8b70cdb7",["s"],"21503455-1ac3-418c-ade2-9897dc71a4a2"],39372:["6bb4b70031",["s"],"27ed4533-c5ab-47a3-b288-7e3ac7e20f2d"]},this.userSegments=[],this.userSegmentsDict={},this.queryStateMap={},this.globalMsgId=0,this.resolves={},this.readSegmentCache(),this.readQueryStateCache(),this.handlers={complete:function(t){var e=r.resolves[t];e&&e(),delete r.resolves[t]},errors:function(t){t.forEach((function(t){r.network.error("QL error. "+t.error+" in query "+t.identifier+" with event "+t.event_id,r._internals.state.userId)}))},stateChange:function(t){if(!r.initialised)return r.stateChangeQueue.push(t);for(var e in t)if(t.hasOwnProperty(e)){var n=parseInt(e),o=t[n];if(o.is_segment){var u=n in r.userSegmentsDict,a=o.result.result;if(u===a)continue;a?r.addSegment(n):r.removeSegment(n),r.trackSegmentTransition(a,o.id,n)}else{var s=r.queryStateMap[n]||{result:{}};if(JSON.stringify(s.result)===JSON.stringify(o.result))continue}r._internals.messages.emit("permutive:query:changed",{queryCode:n,result:o.result})}Object.keys(t).length>0&&(r.queryStateMap=i.mergeObjects(r.queryStateMap,t),r.writeSegmentCache(),r.writeQueryStateCache()),r._internals.messages.emit("permutive:segments:updated")}};var u=new Blob([("("+o.QueryWorker+")();").replace('"use strict";',"")],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(u)),this.worker.onmessage=function(t){switch(t.data.type){case"stateChange":return r.handlers.stateChange(t.data.args);case"errors":return r.handlers.errors(t.data.args);case"complete":return r.handlers.complete(t.data.args)}},this.worker.onerror=function(t){t.preventDefault(),r.network.error("WebWorker error: "+t.message,r._internals.state.userId)}}return e.prototype.initWorker=function(t){return this.sendMessage({type:"init",args:[this.queryMetadata,this.queryStateMap,{segments:{"1p":this.userSegmentsDict},sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:{}},t]})},e.prototype.updateEnvironment=function(t){return this.sendMessage({type:"updateEnvironment",args:[t]})},e.prototype.updateWithHistoricSegments=function(e){return 0===e.length?t.resolve():(this.updateSegmentResults(e),this.sendMessage({type:"processEvents",args:[e]}))},e.prototype.update=function(t){var e=this,n=this.sendMessage({type:"processEvents",args:[t]});return!this._internals.isRealtime&&t.filter((function(t){return"Pageview"===t.name})).length>0&&n.then((function(){e._internals.setAsRealtime()})),n},e.prototype.updateSegmentResults=function(t){var e=this;if(0!==t.length){var n=this.calculateHistoricSegments(t);this._internals.log("New segment states",n),Object.keys(n).forEach((function(t){var r=parseInt(t);n[r]?e.addSegment(r):e.removeSegment(r)})),Object.keys(n).length>0&&this.writeSegmentCache()}},e.prototype.handleResult=function(t,e){t in this.queryStateMap&&e(this.queryStateMap[t].result)},e.prototype.getTpdUsage=function(){for(var t={},e=Object.keys(this.queryStateMap),n=e.length,i=0;i<n;i++){var o=e[i],u=this.queryStateMap[o],a=u.activations;r(u,["activations"]);Object.keys(a).length>0&&(t[o]=a)}return t},e.prototype.reset=function(){this.clearSegmentCache(),this.clearQueryStateCache(),this.userSegments=[],this.userSegmentsDict={},this.queryStateMap={}},e.prototype.setAsReady=function(){this.initialised=!0,this.processStateChangeQueue(),this._internals.messages.emit("permutive:queries:initialised")},e.prototype.getStateSizeInBytes=function(){return 2*JSON.stringify(this.queryStateMap).length},e.prototype.processStateChangeQueue=function(){this._internals.log("state change queue",this.stateChangeQueue);var t=this.stateChangeQueue.reduce((function(t,e){return i.mergeObjects(t,e)}),{});this.stateChangeQueue=[],this._internals.log("final state",t),this.handlers.stateChange(t)},e.prototype.sendMessage=function(e){var n=this,r=this.globalMsgId++;return new t((function(t){n.resolves[r]=t,e.msgId=r,n.worker.postMessage(e)}))},e.prototype.addSegment=function(t){this.userSegmentsDict[t]||(this.userSegments.push(t),this.userSegmentsDict[t]=!0,this.updateQlEffectsSegments())},e.prototype.removeSegment=function(t){if(t in this.userSegmentsDict){delete this.userSegmentsDict[t];var e=this.userSegments.indexOf(t);e>-1&&this.userSegments.splice(e,1),this.updateQlEffectsSegments()}},e.prototype.updateQlEffectsSegments=function(){var t=this;this._internals.thirdParty.segments().then((function(e){t.updateEnvironment({segments:i.mergeObjects({"1p":t.userSegmentsDict},e)})}))},e.prototype.calculateHistoricSegments=function(t){for(var e,n={},r=0;r<t.length;r++){var i=t[r];("SegmentEntry"===(e=i).name||"SegmentExit"===e.name)&&(n[i.properties.segment_number]=u(i))}return n},e.prototype.trackSegmentTransition=function(t,e,n){var r=t?"SegmentEntry":"SegmentExit",i={segment_id:e,segment_number:n};this.permutive.track(r,i)},e.prototype.writeSegmentCache=function(){this._internals.log("Writing segment cache");var t=JSON.stringify(this.userSegments);this._internals.setExternalData(this.CACHED_SEGMENTS_STORAGE_KEY,t)},e.prototype.readSegmentCache=function(){var t=this,e=this._internals.getExternalData(this.CACHED_SEGMENTS_STORAGE_KEY);e&&(this.userSegments=this.filterActiveSegments(JSON.parse(e)),this.userSegments.forEach((function(e){t.userSegmentsDict[e]=!0}))),this._internals.log("Read segment cache",this.userSegments)},e.prototype.filterActiveSegments=function(t){var e=this;return t.filter((function(t){return t in e.queryMetadata}))},e.prototype.clearSegmentCache=function(){this._internals.removeExternalData(this.CACHED_SEGMENTS_STORAGE_KEY)},e.prototype.writeQueryStateCache=function(){this._internals.log("Writing query state cache",this.queryStateMap),this._internals.state.setPermutiveData("query_states",this.queryStateMap)},e.prototype.readQueryStateCache=function(){var t=this,e=this._internals.state.getPermutiveData("query_states")||{};this.queryStateMap=i.filterByKey(e,(function(e){return e in t.queryMetadata})),this._internals.log("Read query state cache",this.queryStateMap)},e.prototype.clearQueryStateCache=function(){this._internals.state.setPermutiveData("query_states",{})},e}();e.QueryManager=a}).call(this,n(3).Promise)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryWorker=void 0,e.QueryWorker=function(){var t=this,e=function(){var t=this&&this.__assign||function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},e=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},n={k:function(t,e){return e.reduce((function(t,e){return t&&null!=t[e]?t[e]:null}),t)},kf:function(t,e,n){var r=e.reduce((function(t,e){return t&&null!=t[e]?t[e]:null}),t);return null===r?null:n(r)},ti:function(t){return new Date(t).getTime()},pre:function(t,e){var n=e.slice();return n.unshift(t),n},n0:function(t){return!t},nt:function(t){return function(e){return!t(e)}},t:function(t){return!0},a:function(t){return t.reduce((function(t,e){return function(n){return t(n)&&e(n)}}))},o:function(t){return t.reduce((function(t,e){return function(n){return t(n)||e(n)}}))},i:function(t){return t},as:function(t,e,r){return function(i){return r.reduce((function(r,o){return r&&t(o)(n.k(i,n.pre("properties",e)))}),!0)}},os:function(t,e,r){return function(i){return r.reduce((function(r,o){return r||t(o)(n.k(i,n.pre("properties",e)))}),!1)}},e:function(t){return function(e){return e===t}},n:function(t){return function(e){return e!==t}},g:function(t){return function(e){return e>t}},ge:function(t){return function(e){return e>=t}},l:function(t){return function(e){return e<t}},le:function(t){return function(e){return e<=t}},b:function(t,e){return function(n){return n>=t&&n<=e}},s:function(t){return function(e){return"string"==typeof t&&"string"==typeof e&&e.toLowerCase().indexOf(t.toLowerCase())>-1}},c:function(t){return function(e){return null!=e&&"object"==typeof e&&e.indexOf(t)>=0}},e_:function(t,e){return function(r){return n.k(r,t)===e}},n_:function(t,e){return function(r){return n.k(r,t)!==e}},g_:function(t,e){return function(r){return n.k(r,t)>e}},ge_:function(t,e){return function(r){return n.k(r,t)>=e}},l_:function(t,e){return function(r){return n.k(r,t)<e}},le_:function(t,e){return function(r){return n.k(r,t)<=e}},b_:function(t,e,r){return function(i){return n.k(i,t)>=e&&n.k(i,t)<=r}},s_:function(t,e){return function(r){var i=n.k(r,t);return"string"==typeof e&&"string"==typeof i&&i.toLowerCase().indexOf(e.toLowerCase())>-1}},c_:function(t,e){return function(r){var i=n.k(r,t);return null!=i&&"object"==typeof i&&i.indexOf(e)>=0}},pe:function(t,e){return function(r){return n.k(r,n.pre("properties",t))===e}},pn:function(t,e){return function(r){return n.k(r,n.pre("properties",t))!==e}},pg:function(t,e){return function(r){return n.k(r,n.pre("properties",t))>e}},pge:function(t,e){return function(r){return n.k(r,n.pre("properties",t))>=e}},pl:function(t,e){return function(r){return n.k(r,n.pre("properties",t))<e}},ple:function(t,e){return function(r){return n.k(r,n.pre("properties",t))<=e}},pb:function(t,e,r){return function(i){return n.k(i,n.pre("properties",t))>=e&&n.k(i,n.pre("properties",t))<=r}},ps:function(t,e){return function(r){var i=n.k(r,n.pre("properties",t));return"string"==typeof e&&"string"==typeof i&&i.toLowerCase().indexOf(e.toLowerCase())>-1}},pc:function(t,e){return function(r){var i=n.k(r,n.pre("properties",t));return null!=i&&"object"==typeof i&&i.indexOf(e)>=0}},te_:function(t,e){return function(r){return n.kf(r,t,n.ti)===e}},tn_:function(t,e){return function(r){return n.kf(r,t,n.ti)!==e}},tg_:function(t,e){return function(r){return n.kf(r,t,n.ti)>e}},tge_:function(t,e){return function(r){return n.kf(r,t,n.ti)>=e}},tl_:function(t,e){return function(r){return n.kf(r,t,n.ti)<e}},tle_:function(t,e){return function(r){return n.kf(r,t,n.ti)<=e}},tb_:function(t,e,r){return function(i){return n.kf(i,t,n.ti)>=e&&n.kf(i,t,n.ti)<=r}},te:function(t){return function(e){return n.kf(e,["time"],n.ti)===t}},tn:function(t){return function(e){return n.kf(e,["time"],n.ti)!==t}},tg:function(t){return function(e){return n.kf(e,["time"],n.ti)>t}},tge:function(t){return function(e){return n.kf(e,["time"],n.ti)>=t}},tl:function(t){return function(e){return n.kf(e,["time"],n.ti)<t}},tle:function(t){return function(e){return n.kf(e,["time"],n.ti)<=t}},tb:function(t,e){return function(r){return n.kf(r,["time"],n.ti)>=t&&n.kf(r,["time"],n.ti)<=e}},af:function(t,e,r,i,o,u){return function(a){var s=n.kf(a,t,(function(t){return t.filter(i).map((function(t){return n.k(t,e)})).reduce(o,u)}));return r(null===s?u:s)}},af_s:function(t,e,r,i){return void 0===i&&(i=function(t){return!0}),n.af(t,e,r,i,(function(t,e){return t+e}),0)},af_p:function(t,e,r,i){return void 0===i&&(i=function(t){return!0}),n.af(t,e,r,i,(function(t,e){return t*e}),1)},af_n:function(t,e,r,i){return void 0===i&&(i=function(t){return!0}),n.af(t,e,r,i,(function(t,e){return Math.min(t,e)}),Number.POSITIVE_INFINITY)},af_x:function(t,e,r,i){return void 0===i&&(i=function(t){return!0}),n.af(t,e,r,i,(function(t,e){return Math.max(t,e)}),Number.NEGATIVE_INFINITY)},af_m:function(t,e,r,i){return void 0===i&&(i=function(t){return!0}),function(o){var u=n.kf(o,t,(function(t){return t.filter(i)}));return null===u||0===u.length?r(0):r(u.map((function(t){return n.k(t,e)})).reduce((function(t,e){return t+e}),0)/u.length)}},af_u:function(t,e,r){return void 0===r&&(r=function(t){return!0}),function(i){return n.kf(i,t,(function(t){return t.filter(r).map(e).reduce((function(t,e){return t||e}),!1)}))||!1}},af_i:function(t,e,r){return void 0===r&&(r=function(t){return!0}),function(i){return n.kf(i,t,(function(t){return t.filter(r).map(e).reduce((function(t,e){return t&&e}),!0)}))&&!0}},af_l:function(t,e,r){return void 0===r&&(r=function(t){return!0}),function(i){var o=n.kf(i,t,(function(t){return t.filter(r).length}));return e(null===o?0:o)}},tp:function(t,e,r,i,o){var u=n.k(t.getSegments(),[e,r])||!1;return o&&(i||u)&&t.setSegmentActivation(e,r,o),u},tpn:function(t,e,r){return n.k(t.getSegments(),[e,r])||!1},oe:function(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r},lms:function(t,e,r){var i,o=t||{},u=e[r]||{},a=(u["1p"]||{}).const||0,s=n.oe(u);for(var c in s){var f=n.oe(s[c][1]);for(var l in f)!0===(o[s[c][0]]||{})[f[l][0]]&&(a+=f[l][1])}return i=a,1/(1+Math.pow(Math.E,-i))},fm:function(t,e){return{p:e.p,r:function(n,r){return t(e.r(n,r))},a:e.a}},acq:function(t,e){return{p:function(n,r){return[t.p(n,r),e.p(n,r)]},r:function(n,r){return t.r(n,r[0])&&e.r(n,r[1])},a:{z:[t.a.z,e.a.z],m:function(n,r){return[t.a.m(n[0],r[0]),e.a.m(n[1],r[1])]}}}},ocq:function(t,e){return{p:function(n,r){return[t.p(n,r),e.p(n,r)]},r:function(n,r){return t.r(n,r[0])||e.r(n,r[1])},a:{z:[t.a.z,e.a.z],m:function(n,r){return[t.a.m(n[0],r[0]),e.a.m(n[1],r[1])]}}}},cw:function(t,e,r){return void 0===r&&(r=n.i),{a:{m:function(t,e){return t+e},z:0},p:function(r,i){return n.k(i,["name"])===t&&e(i)?1:0},r:function(t,e){return r(e)}}},mxw:function(t,e,r,i){void 0===i&&(i=n.i);var o=Number.NEGATIVE_INFINITY;return{a:{m:function(t,e){return t>e?t:e},z:o},p:function(i,u){return n.k(u,["name"])===t&&e(u)?n.k(u,r):o},r:function(t,e){return i(e)}}},vgw:function(t,e,r,i){void 0===i&&(i=n.i);var o={v:0,k:0};return{a:{m:function(t,e){var n=t.k+e.k;return{v:n?t.v+e.k*(e.v-t.v)/n:0,k:n}},z:o},p:function(i,u){return n.k(u,["name"])===t&&e(u)?{v:n.k(u,r),k:1}:o},r:function(t,e){return i(e.v)}}},mnw:function(t,e,r,i){void 0===i&&(i=n.i);var o=Number.POSITIVE_INFINITY;return{a:{m:function(t,e){return t<e?t:e},z:o},p:function(i,u){return n.k(u,["name"])===t&&e(u)?n.k(u,r):o},r:function(t,e){return i(e)}}},sw:function(t,e,r,i){void 0===i&&(i=n.i);return{a:{m:function(t,e){return t+e},z:0},p:function(i,o){return n.k(o,["name"])===t&&e(o)?n.k(o,r):0},r:function(t,e){return i(e)}}},pw:function(t,e,r,i){void 0===i&&(i=n.i);return{a:{m:function(t,e){return t*e},z:1},p:function(i,o){return n.k(o,["name"])===t&&e(o)?n.k(o,r):1},r:function(t,e){return i(e)}}},ctw:function(t,e,r,i){return{a:i?{m:function(t,e){return t.concat(e).slice(-i)},z:[]}:{m:function(t,e){return t.concat(e)},z:[]},p:function(i,o){return n.k(o,["name"])===t&&e(o)?n.k(o,r):[]},r:function(t,e){return e}}},ctv:function(e,r,i,o){function u(t,e){var n=function(t){return{k:t.k,c:1+t.c}},r={arr:[],add:{k:e,c:1}};return e?function(t){return t.arr.concat(t.add)}(t.reduce((function(t,e){return t.add.k===e.k?{arr:t.arr,add:n(e)}:{arr:t.arr.concat(e),add:t.add}}),r)):t}return{a:o?{m:function(t,e){return u(t,e).slice(-o)},z:[]}:{m:function(t,e){return u(t,e)},z:[]},p:function(t,o){return n.k(o,["name"])===e&&r(o)?n.k(o,i):null},r:function(e,n){return n.reduce((function(e,n){var r;return t(t({},e),((r={})[n.k]=n.c,r))}),{})}}},ctu:function(t,e,r,i){return{a:i?{m:function(t,e){return t.filter((function(t){return!e.includes(t)})).concat(e).slice(-i)},z:[]}:{m:function(t,e){return t.filter((function(t){return!e.includes(t)})).concat(e)},z:[]},p:function(i,o){return n.k(o,["name"])===t&&e(o)?n.k(o,r):[]},r:function(t,e){return e}}},itp:function(t,e,r,i){return{a:{m:function(t,e){return e},z:!1},p:function(r,i){return n.tpn(r,t,e)},r:function(o,u){return n.tp(o,t,e,r,i)}}},isp:function(t,e,r,i){return{a:{m:function(t,e){return e},z:!1},p:function(r,i){return n.tpn(r,t,e)},r:function(o,u){return n.tp(o,t,e,r,i)}}},ifp:function(t){return{a:{m:function(t,e){return e},z:!1},p:function(e,r){return n.tp(e,"1p",t,!1)},r:function(t,e){return e}}},lm:function(t,e){return{a:{m:function(t,e){return e},z:[]},p:function(e,r){return[n.lms(e.getSegments(),e.getLookalikeModels(),t)]},r:function(t,n){return!!n[0]&&e(n[0])}}},sq:function(t){return{a:{m:function(e,n){return[n[0],t.a.m(null!=e[0]&&e[0][0]===n[0][0]?e[1]:t.a.z,n[1])]},z:[[],t.a.z]},p:function(e,r){return[[e.getCurrentSession()],n.k(r,["session_id"])===e.getCurrentSession()?t.p(e,r):t.a.z]},r:function(e,n){return t.r(e,n[0]!=[]&&n[0][0]===e.getCurrentSession()?n[1]:t.a.z)}}},vq:function(t){return{a:{m:function(e,n){return[n[0],t.a.m(null!=e[0]&&e[0][0]===n[0][0]?e[1]:t.a.z,n[1])]},z:[[],t.a.z]},p:function(e,r){return[[e.getCurrentView()],n.k(r,["view_id"])===e.getCurrentView()?t.p(e,r):t.a.z]},r:function(e,n){return t.r(e,n[0]!=[]&&n[0][0]===e.getCurrentView()?n[1]:t.a.z)}}},ltn:function(t,e,r){return{a:{m:function(t,e){return t.concat(e).slice(-r)},z:[]},p:function(r,i){return n.k(i,["name"])===e?[t.p(r,i)]:[]},r:function(e,n){return t.r(e,n.reduce((function(e,n){return t.a.m(e,n)}),t.a.z))}}},ftn:function(t,e,r){return{a:{m:function(t,e){return t.concat(e.slice(0,r-t.length))},z:[]},p:function(r,i){return n.k(i,["name"])===e?[t.p(r,i)]:[]},r:function(e,n){return t.r(e,n.reduce((function(e,n){return t.a.m(e,n)}),t.a.z))}}},gb:function(t,e,r){return{a:{m:function(r,i){return Object.keys(r).concat(Object.keys(i)).filter((function(t,e,n){return n.indexOf(t)===e})).sort((function(t,e){return Math.max(n.k(r,[e,1]),n.k(i,[e,1]))-Math.max(n.k(r,[t,1]),n.k(i,[t,1]))})).slice(0,e).reduce((function(e,o){var u=t.a.m(n.k(r,[o,0])||t.a.z,n.k(i,[o,0])||t.a.z);return e[o]=[u,Math.max(n.k(r,[o,1]),n.k(i,[o,1]))],e}),{})},z:{}},p:function(e,i){var o,u,a=n.k(i,n.pre("properties",r)),s=t.p(e,i);return null==a||(null==(u=s)||"object"==typeof u&&0===Object.keys(u).length||u===t.a.z)?{}:((o={})[a]=[s,n.kf(i,["time"],n.ti)],o)},r:function(e,n){var r={};return Object.keys(n).forEach((function(i){return r[i]=t.r(e,n[i][0])})),r}}},tw:function(t,r,i){var o=i||100,u=Math.ceil(r/o),a=function(t,e,n){var i;return[Math.floor((t-r)/u),(i={},i[Math.floor(e/u)]=n,i)]},s=function(e,n){var r=Math.max(e[0],n[0]),i=Object.keys(e[1]).filter((function(t){return t>=r})).concat(Object.keys(n[1]).filter((function(t){return t>=r}))).filter((function(t,e,n){return n.indexOf(t)===e})).reduce((function(r,i){var o=t.a.m(e[1][i]||t.a.z,n[1][i]||t.a.z);return o!==t.a.z&&(r[i]=o),r}),{});return[r,i]},c=[Number.NEGATIVE_INFINITY,{}],f=function(t){var n=function(n){return n.map((function(n){var r=e(n,3),i=r[0],o=(r[1],r[2]);return a(t.t,o,i)})).reduce(s,c)};return s(n(t.in),n(t.out))};return{a:{m:function(t,e){var n=t.w?f(t):t;return s(n,e)},z:c},p:function(e,r){return a(e.getCurrentTime(),n.kf(r,["time"],n.ti),t.p(e,r))},r:function(e,n){var r=(n.w?f(n):n)[1];return t.r(e,Object.keys(r).reduce((function(e,n){return t.a.m(e,r[n])}),t.a.z))}}},q:function(t){return{initial:function(e){return{result:t.a.z}},update:function(e,n,r){return{result:t.a.m(n.result,t.p(e,r))}},result:function(e,n){return{result:t.r(e,n.result)}},m:t.a.m,z:t.a.z,p:t.p,r:t.r}}},r={39204:n.q(n.cw("Pageview",n.t,n.ge(1))),39372:n.q(n.cw("Pageview",n.ps(["article","channel"],"sport"),n.ge(2)))};return void 0!==r?r:{}}(),n=null,r=!1,i=[],o={},u={},a=function(e){switch(e.type){case"init":return t.init(e.msgId,e.args[0],e.args[1],e.args[2],e.args[3]);case"processEvents":return t.processEvents(e.msgId,e.args[0]);case"updateEnvironment":return t.updateEnvironment(e.msgId,e.args[0]);default:throw Error("Unexpected message "+e)}},s=function(e){t.postMessage({type:"complete",args:e})},c=function(e){0!==Object.keys(e).length&&t.postMessage({type:"stateChange",args:e})},f=function(e){0!==e.length&&t.postMessage({type:"errors",args:e})},l=function(t,u){var s={},l=[];t.forEach((function(t){var r=e[t],i=o[t];u.forEach((function(e){try{i.state=r.update(n,i.state,e)}catch(n){l.push({error:n.toString(),identifier:t,event_id:e.id})}})),i.result=r.result(n,i.state),s[t]=o[t]})),c(s),f(l),r=!0,i.forEach(a),i=[]};this.init=function(t,r,i,a,c){var f=a.lookalikeModels||{},d=function(t,e,n){var r=o[n].activations;t in r?-1!==r[t].indexOf(e)||r[t].push(e):r[t]=[e]};o=i,u=r,n={getCurrentTime:function(){return new Date},getCurrentSession:function(){return a.sessionId},getCurrentView:function(){return a.viewId},getSegments:function(){return{"1p":a.segments["1p"]}},getLookalikeModels:function(){return f},setThirdPartyActivation:function(t,e){},setSegmentActivation:function(t,e){}};var p=[];Object.keys(u).forEach((function(t){var r=u[t];if(!(t in i)||i[t].checksum!==r[0]){p.push(parseInt(t));var a=e[t],s=a.initial(n);o[t]={id:r[2],is_segment:r[1].indexOf("s")>-1,checksum:r[0],state:s,result:a.result(n,s),activations:{}}}})),l(p,c),n.getSegments=function(){return a.segments},n.setSegmentActivation=d,n.setThirdPartyActivation=d,l(p,[{}]),s(t)},this.updateEnvironment=function(e,o){if(!r)return i.push({msgId:e,type:"updateEnvironment",args:[o]});o.sessionId&&(n.getCurrentSession=function(){return o.sessionId}),o.segments&&(n.getSegments=function(){return o.segments}),o.lookalikeModels&&(n.getLookalikeModels=function(){return o.lookalikeModels}),t.processEvents(e,[{}])},this.processEvents=function(t,a){if(!r)return i.push({msgId:t,type:"processEvents",args:[a]});var l={},d=[];a.forEach((function(t){Object.keys(u).forEach((function(r){var i=e[r],u=o[r].state;try{var a=i.update(n,u,t);JSON.stringify(u)!==JSON.stringify(a)&&(o[r].state=a,o[r].result=i.result(n,a),l[r]=o[r])}catch(e){d.push({error:e.toString(),identifier:r,event_id:t.id})}}))})),c(l),f(d),s(t)},onmessage=function(t){a(t.data)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"sequenceT",(function(){return a})),n.d(e,"sequenceS",(function(){return s}));var r=n(6);function i(t,e,n){return function(r){var o=n.concat([r]);return 0===e?t.apply(null,o):i(t,e-1,o)}}var o={};function u(t){return o.hasOwnProperty(t)||(o[t]=i(r.tuple,t-1,[])),o[t]}function a(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=e.length,i=u(r),o=t.map(e[0],i),a=1;a<r;a++)o=t.ap(o,e[a]);return o}}function s(t){return function(e){for(var n=Object.keys(e),r=n.length,o=function(t){var e=t.length;return i((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},o=0;o<e;o++)i[t[o]]=n[o];return i}),e-1,[])}(n),u=t.map(e[n[0]],o),a=1;a<r;a++)u=t.ap(u,e[n[a]]);return u}}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.register=e.GraphQLGeoIP=void 0;var o=n(4),u=function(t){function e(e){var n=t.call(this)||this;return n.replacementMap={$ip_geo_info:e.geo,$ip_isp_info:e.isp,$ip_address:e.ip,$ip_address_hash:e.ip_hash},n}return i(e,t),e}(n(19).SingleEnricher),a=function(t){var e=this;this.resource="geoip",this.query=function(){return"geoip { "+[e.config.includeGeo?"geo { continent country city province postal_code }":"",e.config.includeISP?"isp { isp organization autonomous_system_number autonomous_system_organization }":"",e.config.includeIP?"ip":"",e.config.includeIPHash?"ip_hash":""].join(" ")+" }"},this.config=t};e.GraphQLGeoIP=a,e.register=function(t,e){var n=function(t){t.isp&&(e.isp=t.isp.isp,e.organization=t.isp.organization,e.autonomous_system_number=t.isp.autonomous_system_number,e.autonomous_system_organization=t.isp.autonomous_system_organization),t.geo&&(e.continent=t.geo.continent,e.country=t.geo.country,e.city=t.geo.city,e.province=t.geo.province,e.postal_code=t.geo.postal_code)},r=t.state.getPermutiveData("enricher:geoip");if(r&&r.session_id===t.sessionManager.getSessionId())n(r.data),t.enrichers.register(new u(r.data));else{var i={includeGeo:o.lens({geoip:{}},"geoip","include_geo")||!0,includeISP:o.lens({geoip:{}},"geoip","include_isp")||!0,includeIPHash:o.lens({geoip:{}},"geoip","include_ip_hash")||!0,includeIP:o.lens({geoip:{}},"geoip","include_ip")||!1};t.graphql.register(new a(i)).then((function(e){n(e),t.state.setPermutiveData("enricher:geoip",{session_id:t.sessionManager.getSessionId(),data:e}),t.enrichers.register(new u(e))})).catch((function(e){return t.network.error("Error while registering the geoip enricher: got "+e)}))}}}]);